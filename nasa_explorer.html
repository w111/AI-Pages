<!doctype html>
<!--
ТЕХНИЧЕСКОЕ ЗАДАНИЕ

Цель: Создать интерактивную страницу для исследования космоса с использованием NASA Open APIs.

Функциональные требования:
1. APOD (Astronomy Picture of the Day):
   - Отображение астрономического фото дня
   - Выбор даты для просмотра прошлых фотографий
   - Отображение заголовка, описания и информации об авторских правах
   - Поддержка видео (YouTube)

2. Mars Rover Photos:
   - Выбор марсохода (Curiosity, Opportunity, Spirit)
   - Выбор камеры
   - Выбор Sol (марсианский день) или земной даты
   - Галерея фотографий с пагинацией

3. NASA Image Search:
   - Поиск изображений по ключевым словам
   - Фильтрация по типу медиа
   - Галерея результатов

4. Пользовательский интерфейс:
   - Темная/светлая тема
   - Адаптивный дизайн
   - Модальное окно для просмотра изображений
   - Анимации загрузки

Технические требования:
1. NASA Open APIs (DEMO_KEY для демонстрации)
2. LocalStorage для кэширования и настроек
3. CSS переменные для темизации
4. Font Awesome для иконок
-->

<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>NASA Explorer - Исследуй космос</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
      :root {
        --bg-color: #0a0a1a;
        --card-bg: #12122a;
        --text-color: #e8e8f0;
        --text-secondary: #a0a0b8;
        --border-color: #2a2a4a;
        --primary-color: #4a90d9;
        --primary-hover: #6aa8f0;
        --accent-color: #ff6b35;
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        --shadow-hover: 0 8px 30px rgba(74, 144, 217, 0.3);
        --gradient-start: #0a0a1a;
        --gradient-end: #1a1a3a;
        --input-bg: #1a1a30;
        --input-border: #3a3a5a;
        --success-color: #4caf50;
        --error-color: #f44336;
      }

      [data-theme="light"] {
        --bg-color: #f0f4f8;
        --card-bg: #ffffff;
        --text-color: #1a1a2e;
        --text-secondary: #5a5a7a;
        --border-color: #d0d8e0;
        --primary-color: #2563eb;
        --primary-hover: #1d4ed8;
        --accent-color: #dc2626;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        --shadow-hover: 0 8px 25px rgba(37, 99, 235, 0.2);
        --gradient-start: #e8f0f8;
        --gradient-end: #f0f4f8;
        --input-bg: #ffffff;
        --input-border: #c0c8d0;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
        background: linear-gradient(180deg, var(--gradient-start), var(--gradient-end));
        min-height: 100vh;
        color: var(--text-color);
        transition: background 0.3s ease, color 0.3s ease;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Header */
      .header {
        text-align: center;
        padding: 30px 0;
        margin-bottom: 30px;
        position: relative;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header p {
        color: var(--text-secondary);
        font-size: 1.1rem;
      }

      .theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .theme-toggle:hover {
        background: var(--primary-color);
        color: white;
      }

      /* Tabs */
      .tabs {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .tab-btn {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .tab-btn:hover {
        border-color: var(--primary-color);
      }

      .tab-btn.active {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
      }

      /* Tab Content */
      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* APOD Section */
      .apod-container {
        background: var(--card-bg);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--shadow);
      }

      .apod-controls {
        padding: 20px;
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
        border-bottom: 1px solid var(--border-color);
      }

      .apod-controls label {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .apod-controls input[type="date"] {
        background: var(--input-bg);
        border: 1px solid var(--input-border);
        color: var(--text-color);
        padding: 10px 15px;
        border-radius: 8px;
        font-size: 1rem;
      }

      .apod-controls button {
        background: var(--primary-color);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .apod-controls button:hover {
        background: var(--primary-hover);
      }

      .apod-content {
        padding: 0;
      }

      .apod-media {
        width: 100%;
        max-height: 600px;
        object-fit: contain;
        background: #000;
      }

      .apod-media-container {
        position: relative;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 300px;
      }

      .apod-video {
        width: 100%;
        height: 500px;
        border: none;
      }

      .apod-info {
        padding: 25px;
      }

      .apod-title {
        font-size: 1.8rem;
        margin-bottom: 15px;
        color: var(--text-color);
      }

      .apod-date {
        color: var(--primary-color);
        font-size: 0.95rem;
        margin-bottom: 15px;
      }

      .apod-explanation {
        color: var(--text-secondary);
        line-height: 1.8;
        font-size: 1rem;
      }

      .apod-copyright {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      /* Mars Rover Section */
      .rover-controls {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: var(--shadow);
      }

      .controls-row {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }

      .control-group {
        flex: 1;
        min-width: 200px;
      }

      .control-group label {
        display: block;
        color: var(--text-secondary);
        margin-bottom: 8px;
        font-size: 0.9rem;
      }

      .control-group select,
      .control-group input {
        width: 100%;
        background: var(--input-bg);
        border: 1px solid var(--input-border);
        color: var(--text-color);
        padding: 12px 15px;
        border-radius: 8px;
        font-size: 1rem;
      }

      .search-btn {
        background: var(--primary-color);
        border: none;
        color: white;
        padding: 12px 30px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .search-btn:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
      }

      .search-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      /* Gallery */
      .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
      }

      .gallery-item {
        background: var(--card-bg);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .gallery-item:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-hover);
      }

      .gallery-item img {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }

      .gallery-item-info {
        padding: 15px;
      }

      .gallery-item-info h4 {
        font-size: 0.95rem;
        color: var(--text-color);
        margin-bottom: 5px;
      }

      .gallery-item-info p {
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      /* NASA Image Search */
      .search-container {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: var(--shadow);
      }

      .search-input-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }

      .search-input {
        flex: 1;
        min-width: 300px;
        background: var(--input-bg);
        border: 1px solid var(--input-border);
        color: var(--text-color);
        padding: 15px 20px;
        border-radius: 8px;
        font-size: 1rem;
      }

      .search-input::placeholder {
        color: var(--text-secondary);
      }

      /* Pagination */
      .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 30px;
      }

      .pagination button {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .pagination button:hover:not(:disabled) {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
      }

      .pagination button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .pagination span {
        display: flex;
        align-items: center;
        color: var(--text-secondary);
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        position: relative;
        max-width: 90%;
        max-height: 90%;
      }

      .modal-content img {
        max-width: 100%;
        max-height: 85vh;
        border-radius: 8px;
      }

      .modal-close {
        position: absolute;
        top: -40px;
        right: 0;
        background: none;
        border: none;
        color: white;
        font-size: 2rem;
        cursor: pointer;
      }

      .modal-info {
        color: white;
        text-align: center;
        margin-top: 15px;
        max-width: 800px;
      }

      .modal-info h3 {
        margin-bottom: 10px;
      }

      .modal-info p {
        color: #ccc;
        font-size: 0.9rem;
      }

      /* Loading */
      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px;
        color: var(--text-secondary);
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 3px solid var(--border-color);
        border-top-color: var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 15px;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      /* Error */
      .error-message {
        background: rgba(244, 67, 54, 0.1);
        border: 1px solid var(--error-color);
        color: var(--error-color);
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        margin: 20px 0;
      }

      /* No Results */
      .no-results {
        text-align: center;
        padding: 60px;
        color: var(--text-secondary);
      }

      .no-results i {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      /* Stats */
      .stats-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 15px 20px;
        background: var(--card-bg);
        border-radius: 8px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .stats-bar span {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.8rem;
        }

        .theme-toggle {
          position: static;
          margin-bottom: 20px;
        }

        .header {
          padding-top: 10px;
        }

        .tabs {
          flex-direction: column;
          align-items: stretch;
        }

        .tab-btn {
          justify-content: center;
        }

        .control-group {
          min-width: 100%;
        }

        .search-input {
          min-width: 100%;
        }

        .apod-title {
          font-size: 1.4rem;
        }
      }

      /* Back Link */
      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        text-decoration: none;
        margin-bottom: 20px;
        padding: 8px 0;
        transition: color 0.3s ease;
      }

      .back-link:hover {
        color: var(--primary-color);
      }

      /* Random Button */
      .random-btn {
        background: var(--accent-color);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .random-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
      }

      /* HD Badge */
      .hd-badge {
        display: inline-block;
        background: var(--accent-color);
        color: white;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: bold;
        margin-left: 10px;
      }

      /* Download Button */
      .download-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: var(--success-color);
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 0.9rem;
        margin-top: 15px;
        transition: all 0.3s ease;
      }

      .download-btn:hover {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="index.html" class="back-link">
        <i class="fas fa-arrow-left"></i> Вернуться на главную
      </a>

      <header class="header">
        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-sun"></i>
        </button>
        <h1><i class="fas fa-rocket"></i> NASA Explorer</h1>
        <p>Исследуйте космос с помощью NASA Open APIs</p>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="apod">
          <i class="fas fa-image"></i> Фото дня
        </button>
        <button class="tab-btn" data-tab="mars">
          <i class="fas fa-planet-ringed"></i> Марсоходы
        </button>
        <button class="tab-btn" data-tab="search">
          <i class="fas fa-search"></i> Поиск NASA
        </button>
      </div>

      <!-- APOD Tab -->
      <div class="tab-content active" id="apod">
        <div class="apod-container">
          <div class="apod-controls">
            <label for="apodDate">Выберите дату:</label>
            <input type="date" id="apodDate" />
            <button id="loadApod"><i class="fas fa-sync-alt"></i> Загрузить</button>
            <button class="random-btn" id="randomApod">
              <i class="fas fa-random"></i> Случайное фото
            </button>
          </div>
          <div class="apod-content" id="apodContent">
            <div class="loading">
              <div class="spinner"></div>
              <p>Загрузка астрономического фото дня...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Mars Rover Tab -->
      <div class="tab-content" id="mars">
        <div class="rover-controls">
          <div class="controls-row">
            <div class="control-group">
              <label for="roverSelect">Марсоход</label>
              <select id="roverSelect">
                <option value="curiosity">Curiosity</option>
                <option value="opportunity">Opportunity</option>
                <option value="spirit">Spirit</option>
                <option value="perseverance">Perseverance</option>
              </select>
            </div>
            <div class="control-group">
              <label for="cameraSelect">Камера</label>
              <select id="cameraSelect">
                <option value="">Все камеры</option>
                <option value="FHAZ">Front Hazard Avoidance</option>
                <option value="RHAZ">Rear Hazard Avoidance</option>
                <option value="MAST">Mast Camera</option>
                <option value="CHEMCAM">Chemistry and Camera</option>
                <option value="MAHLI">Mars Hand Lens Imager</option>
                <option value="MARDI">Mars Descent Imager</option>
                <option value="NAVCAM">Navigation Camera</option>
                <option value="PANCAM">Panoramic Camera</option>
                <option value="MINITES">Mini-TES</option>
              </select>
            </div>
            <div class="control-group">
              <label for="solInput">Sol (Марсианский день)</label>
              <input type="number" id="solInput" value="1000" min="0" />
            </div>
          </div>
          <div class="controls-row">
            <div class="control-group">
              <label for="earthDate">Или выберите земную дату</label>
              <input type="date" id="earthDate" />
            </div>
            <button class="search-btn" id="loadRoverPhotos">
              <i class="fas fa-camera"></i> Загрузить фотографии
            </button>
            <button class="random-btn" id="latestRoverPhotos">
              <i class="fas fa-clock"></i> Последние фото
            </button>
          </div>
        </div>

        <div id="roverStats" class="stats-bar" style="display: none;">
          <span id="roverInfo"></span>
          <span id="photoCount"></span>
        </div>

        <div class="gallery" id="roverGallery"></div>
        <div class="pagination" id="roverPagination" style="display: none;">
          <button id="prevPage"><i class="fas fa-chevron-left"></i> Назад</button>
          <span id="pageInfo">Страница 1</span>
          <button id="nextPage">Вперед <i class="fas fa-chevron-right"></i></button>
        </div>
      </div>

      <!-- NASA Image Search Tab -->
      <div class="tab-content" id="search">
        <div class="search-container">
          <div class="search-input-group">
            <input type="text" class="search-input" id="nasaSearchInput"
              placeholder="Поиск изображений NASA (например: galaxy, mars, earth...)" />
            <select id="mediaType" style="background: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-color); padding: 12px 15px; border-radius: 8px;">
              <option value="image">Изображения</option>
              <option value="video">Видео</option>
            </select>
            <button class="search-btn" id="nasaSearchBtn">
              <i class="fas fa-search"></i> Искать
            </button>
          </div>
        </div>

        <div id="searchStats" class="stats-bar" style="display: none;">
          <span id="searchResultsInfo"></span>
        </div>

        <div class="gallery" id="searchGallery"></div>
        <div class="pagination" id="searchPagination" style="display: none;">
          <button id="searchPrevPage"><i class="fas fa-chevron-left"></i> Назад</button>
          <span id="searchPageInfo">Страница 1</span>
          <button id="searchNextPage">Вперед <i class="fas fa-chevron-right"></i></button>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="imageModal">
      <div class="modal-content">
        <button class="modal-close" id="modalClose">&times;</button>
        <img id="modalImage" src="" alt="" />
        <div class="modal-info">
          <h3 id="modalTitle"></h3>
          <p id="modalDescription"></p>
        </div>
      </div>
    </div>

    <script>
      /**
       * NASA Explorer Application
       * Использует NASA Open APIs для отображения космических изображений
       */

      const NASA_API_KEY = "DEMO_KEY";
      const NASA_API_BASE = "https://api.nasa.gov";
      const NASA_IMAGES_API = "https://images-api.nasa.gov";

      // State
      let currentRoverPage = 1;
      let roverPhotos = [];
      let currentSearchPage = 1;
      let searchResults = [];
      let totalSearchResults = 0;

      /**
       * Инициализация приложения
       */
      function init() {
        initTheme();
        initTabs();
        initAPOD();
        initMarsRover();
        initNASASearch();
        initModal();
      }

      /**
       * Инициализация темы
       */
      function initTheme() {
        const savedTheme = localStorage.getItem("nasa-explorer-theme") || "dark";
        document.documentElement.setAttribute("data-theme", savedTheme);
        updateThemeIcon(savedTheme);

        document.getElementById("themeToggle").addEventListener("click", () => {
          const currentTheme = document.documentElement.getAttribute("data-theme");
          const newTheme = currentTheme === "dark" ? "light" : "dark";
          document.documentElement.setAttribute("data-theme", newTheme);
          localStorage.setItem("nasa-explorer-theme", newTheme);
          updateThemeIcon(newTheme);
        });
      }

      /**
       * Обновление иконки темы
       */
      function updateThemeIcon(theme) {
        const icon = document.querySelector("#themeToggle i");
        icon.className = theme === "dark" ? "fas fa-sun" : "fas fa-moon";
      }

      /**
       * Инициализация вкладок
       */
      function initTabs() {
        const tabBtns = document.querySelectorAll(".tab-btn");
        const tabContents = document.querySelectorAll(".tab-content");

        tabBtns.forEach(btn => {
          btn.addEventListener("click", () => {
            const tabId = btn.dataset.tab;

            tabBtns.forEach(b => b.classList.remove("active"));
            tabContents.forEach(c => c.classList.remove("active"));

            btn.classList.add("active");
            document.getElementById(tabId).classList.add("active");
          });
        });
      }

      /**
       * Инициализация APOD
       */
      function initAPOD() {
        const dateInput = document.getElementById("apodDate");
        const today = new Date().toISOString().split("T")[0];
        dateInput.value = today;
        dateInput.max = today;
        dateInput.min = "1995-06-16"; // Первое APOD

        document.getElementById("loadApod").addEventListener("click", () => {
          loadAPOD(dateInput.value);
        });

        document.getElementById("randomApod").addEventListener("click", () => {
          const start = new Date("1995-06-16");
          const end = new Date();
          const randomDate = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
          const dateStr = randomDate.toISOString().split("T")[0];
          dateInput.value = dateStr;
          loadAPOD(dateStr);
        });

        loadAPOD(today);
      }

      /**
       * Загрузка APOD
       */
      async function loadAPOD(date) {
        const container = document.getElementById("apodContent");
        container.innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <p>Загрузка астрономического фото дня...</p>
          </div>
        `;

        try {
          const response = await fetch(
            `${NASA_API_BASE}/planetary/apod?api_key=${NASA_API_KEY}&date=${date}`
          );

          if (!response.ok) {
            throw new Error("Не удалось загрузить данные");
          }

          const data = await response.json();
          displayAPOD(data);
        } catch (error) {
          container.innerHTML = `
            <div class="error-message">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Ошибка загрузки: ${error.message}</p>
            </div>
          `;
        }
      }

      /**
       * Отображение APOD
       */
      function displayAPOD(data) {
        const container = document.getElementById("apodContent");
        const isVideo = data.media_type === "video";

        let mediaHtml;
        if (isVideo) {
          mediaHtml = `
            <div class="apod-media-container">
              <iframe class="apod-video" src="${data.url}" allowfullscreen></iframe>
            </div>
          `;
        } else {
          mediaHtml = `
            <div class="apod-media-container">
              <img class="apod-media" src="${data.url}" alt="${data.title}"
                onclick="openModal('${data.hdurl || data.url}', '${escapeHtml(data.title)}', '')" />
            </div>
          `;
        }

        const hdBadge = data.hdurl ? '<span class="hd-badge">HD</span>' : '';
        const downloadBtn = data.hdurl ? `
          <a href="${data.hdurl}" target="_blank" class="download-btn">
            <i class="fas fa-download"></i> Скачать HD
          </a>
        ` : '';

        container.innerHTML = `
          ${mediaHtml}
          <div class="apod-info">
            <h2 class="apod-title">${data.title}${hdBadge}</h2>
            <p class="apod-date">
              <i class="fas fa-calendar"></i> ${formatDate(data.date)}
            </p>
            <p class="apod-explanation">${data.explanation}</p>
            ${data.copyright ? `
              <p class="apod-copyright">
                <i class="fas fa-copyright"></i> ${data.copyright}
              </p>
            ` : ''}
            ${downloadBtn}
          </div>
        `;
      }

      /**
       * Инициализация Mars Rover
       */
      function initMarsRover() {
        document.getElementById("loadRoverPhotos").addEventListener("click", loadRoverPhotos);
        document.getElementById("latestRoverPhotos").addEventListener("click", loadLatestRoverPhotos);
        document.getElementById("prevPage").addEventListener("click", () => {
          if (currentRoverPage > 1) {
            currentRoverPage--;
            displayRoverPhotos();
          }
        });
        document.getElementById("nextPage").addEventListener("click", () => {
          currentRoverPage++;
          displayRoverPhotos();
        });
      }

      /**
       * Загрузка фотографий марсохода
       */
      async function loadRoverPhotos() {
        const rover = document.getElementById("roverSelect").value;
        const camera = document.getElementById("cameraSelect").value;
        const sol = document.getElementById("solInput").value;
        const earthDate = document.getElementById("earthDate").value;

        const gallery = document.getElementById("roverGallery");
        gallery.innerHTML = `
          <div class="loading" style="grid-column: 1 / -1;">
            <div class="spinner"></div>
            <p>Загрузка фотографий с марсохода ${rover.charAt(0).toUpperCase() + rover.slice(1)}...</p>
          </div>
        `;

        try {
          let url = `${NASA_API_BASE}/mars-photos/api/v1/rovers/${rover}/photos?api_key=${NASA_API_KEY}`;

          if (earthDate) {
            url += `&earth_date=${earthDate}`;
          } else {
            url += `&sol=${sol}`;
          }

          if (camera) {
            url += `&camera=${camera}`;
          }

          const response = await fetch(url);

          if (!response.ok) {
            throw new Error("Не удалось загрузить данные");
          }

          const data = await response.json();
          roverPhotos = data.photos;
          currentRoverPage = 1;

          if (roverPhotos.length > 0) {
            const roverInfo = roverPhotos[0].rover;
            document.getElementById("roverInfo").innerHTML = `
              <i class="fas fa-robot"></i> ${roverInfo.name} |
              Статус: ${roverInfo.status} |
              Посадка: ${formatDate(roverInfo.landing_date)}
            `;
            document.getElementById("photoCount").textContent = `Найдено фотографий: ${roverPhotos.length}`;
            document.getElementById("roverStats").style.display = "flex";
          }

          displayRoverPhotos();
        } catch (error) {
          gallery.innerHTML = `
            <div class="error-message" style="grid-column: 1 / -1;">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Ошибка загрузки: ${error.message}</p>
            </div>
          `;
        }
      }

      /**
       * Загрузка последних фотографий марсохода
       */
      async function loadLatestRoverPhotos() {
        const rover = document.getElementById("roverSelect").value;
        const gallery = document.getElementById("roverGallery");

        gallery.innerHTML = `
          <div class="loading" style="grid-column: 1 / -1;">
            <div class="spinner"></div>
            <p>Загрузка последних фотографий с марсохода ${rover.charAt(0).toUpperCase() + rover.slice(1)}...</p>
          </div>
        `;

        try {
          const response = await fetch(
            `${NASA_API_BASE}/mars-photos/api/v1/rovers/${rover}/latest_photos?api_key=${NASA_API_KEY}`
          );

          if (!response.ok) {
            throw new Error("Не удалось загрузить данные");
          }

          const data = await response.json();
          roverPhotos = data.latest_photos;
          currentRoverPage = 1;

          if (roverPhotos.length > 0) {
            const roverInfo = roverPhotos[0].rover;
            document.getElementById("roverInfo").innerHTML = `
              <i class="fas fa-robot"></i> ${roverInfo.name} |
              Статус: ${roverInfo.status} |
              Последнее фото: ${formatDate(roverPhotos[0].earth_date)}
            `;
            document.getElementById("photoCount").textContent = `Найдено фотографий: ${roverPhotos.length}`;
            document.getElementById("roverStats").style.display = "flex";
          }

          displayRoverPhotos();
        } catch (error) {
          gallery.innerHTML = `
            <div class="error-message" style="grid-column: 1 / -1;">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Ошибка загрузки: ${error.message}</p>
            </div>
          `;
        }
      }

      /**
       * Отображение фотографий марсохода
       */
      function displayRoverPhotos() {
        const gallery = document.getElementById("roverGallery");
        const pagination = document.getElementById("roverPagination");
        const pageInfo = document.getElementById("pageInfo");
        const prevBtn = document.getElementById("prevPage");
        const nextBtn = document.getElementById("nextPage");

        if (roverPhotos.length === 0) {
          gallery.innerHTML = `
            <div class="no-results" style="grid-column: 1 / -1;">
              <i class="fas fa-image"></i>
              <h3>Фотографии не найдены</h3>
              <p>Попробуйте изменить параметры поиска</p>
            </div>
          `;
          pagination.style.display = "none";
          return;
        }

        const photosPerPage = 12;
        const totalPages = Math.ceil(roverPhotos.length / photosPerPage);
        const startIndex = (currentRoverPage - 1) * photosPerPage;
        const endIndex = startIndex + photosPerPage;
        const pagePhotos = roverPhotos.slice(startIndex, endIndex);

        gallery.innerHTML = pagePhotos.map(photo => `
          <div class="gallery-item" onclick="openModal('${photo.img_src}', 'Sol ${photo.sol} - ${photo.camera.full_name}', 'Земная дата: ${formatDate(photo.earth_date)}')">
            <img src="${photo.img_src}" alt="Mars photo" loading="lazy" />
            <div class="gallery-item-info">
              <h4>${photo.camera.full_name}</h4>
              <p>Sol ${photo.sol} | ${formatDate(photo.earth_date)}</p>
            </div>
          </div>
        `).join("");

        pagination.style.display = "flex";
        pageInfo.textContent = `Страница ${currentRoverPage} из ${totalPages}`;
        prevBtn.disabled = currentRoverPage === 1;
        nextBtn.disabled = currentRoverPage === totalPages;
      }

      /**
       * Инициализация поиска NASA
       */
      function initNASASearch() {
        const searchInput = document.getElementById("nasaSearchInput");
        const searchBtn = document.getElementById("nasaSearchBtn");

        searchBtn.addEventListener("click", () => searchNASA(searchInput.value));
        searchInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            searchNASA(searchInput.value);
          }
        });

        document.getElementById("searchPrevPage").addEventListener("click", () => {
          if (currentSearchPage > 1) {
            currentSearchPage--;
            searchNASA(searchInput.value, currentSearchPage);
          }
        });

        document.getElementById("searchNextPage").addEventListener("click", () => {
          currentSearchPage++;
          searchNASA(searchInput.value, currentSearchPage);
        });
      }

      /**
       * Поиск по NASA Image Library
       */
      async function searchNASA(query, page = 1) {
        if (!query.trim()) return;

        const gallery = document.getElementById("searchGallery");
        const mediaType = document.getElementById("mediaType").value;

        gallery.innerHTML = `
          <div class="loading" style="grid-column: 1 / -1;">
            <div class="spinner"></div>
            <p>Поиск изображений NASA...</p>
          </div>
        `;

        try {
          const response = await fetch(
            `${NASA_IMAGES_API}/search?q=${encodeURIComponent(query)}&media_type=${mediaType}&page=${page}`
          );

          if (!response.ok) {
            throw new Error("Не удалось выполнить поиск");
          }

          const data = await response.json();
          searchResults = data.collection.items;
          totalSearchResults = data.collection.metadata.total_hits;
          currentSearchPage = page;

          document.getElementById("searchResultsInfo").textContent =
            `Найдено результатов: ${totalSearchResults.toLocaleString()}`;
          document.getElementById("searchStats").style.display = "flex";

          displaySearchResults();
        } catch (error) {
          gallery.innerHTML = `
            <div class="error-message" style="grid-column: 1 / -1;">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Ошибка поиска: ${error.message}</p>
            </div>
          `;
        }
      }

      /**
       * Отображение результатов поиска
       */
      function displaySearchResults() {
        const gallery = document.getElementById("searchGallery");
        const pagination = document.getElementById("searchPagination");
        const pageInfo = document.getElementById("searchPageInfo");
        const prevBtn = document.getElementById("searchPrevPage");
        const nextBtn = document.getElementById("searchNextPage");

        if (searchResults.length === 0) {
          gallery.innerHTML = `
            <div class="no-results" style="grid-column: 1 / -1;">
              <i class="fas fa-search"></i>
              <h3>Ничего не найдено</h3>
              <p>Попробуйте изменить поисковый запрос</p>
            </div>
          `;
          pagination.style.display = "none";
          return;
        }

        gallery.innerHTML = searchResults.map(item => {
          const data = item.data[0];
          const links = item.links || [];
          const thumbnail = links.find(l => l.rel === "preview")?.href || "";

          return `
            <div class="gallery-item" onclick="openModal('${thumbnail}', '${escapeHtml(data.title)}', '${escapeHtml(data.description?.substring(0, 200) || "")}...')">
              <img src="${thumbnail}" alt="${escapeHtml(data.title)}" loading="lazy"
                onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23333%22 width=%22100%22 height=%22100%22/><text fill=%22%23666%22 font-size=%2214%22 x=%2250%22 y=%2255%22 text-anchor=%22middle%22>No Image</text></svg>'" />
              <div class="gallery-item-info">
                <h4>${data.title?.substring(0, 50)}${data.title?.length > 50 ? "..." : ""}</h4>
                <p>${data.date_created ? formatDate(data.date_created.split("T")[0]) : "Дата неизвестна"}</p>
              </div>
            </div>
          `;
        }).join("");

        const totalPages = Math.ceil(totalSearchResults / 100);
        pagination.style.display = "flex";
        pageInfo.textContent = `Страница ${currentSearchPage} из ${totalPages}`;
        prevBtn.disabled = currentSearchPage === 1;
        nextBtn.disabled = currentSearchPage >= totalPages;
      }

      /**
       * Инициализация модального окна
       */
      function initModal() {
        const modal = document.getElementById("imageModal");

        document.getElementById("modalClose").addEventListener("click", closeModal);
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            closeModal();
          }
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            closeModal();
          }
        });
      }

      /**
       * Открытие модального окна
       */
      function openModal(imageUrl, title, description) {
        const modal = document.getElementById("imageModal");
        document.getElementById("modalImage").src = imageUrl;
        document.getElementById("modalTitle").textContent = title;
        document.getElementById("modalDescription").textContent = description;
        modal.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      /**
       * Закрытие модального окна
       */
      function closeModal() {
        const modal = document.getElementById("imageModal");
        modal.classList.remove("active");
        document.body.style.overflow = "";
      }

      /**
       * Форматирование даты
       */
      function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString("ru-RU", {
          year: "numeric",
          month: "long",
          day: "numeric"
        });
      }

      /**
       * Экранирование HTML
       */
      function escapeHtml(text) {
        if (!text) return "";
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML.replace(/'/g, "\\'").replace(/"/g, "&quot;");
      }

      // Запуск приложения
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
