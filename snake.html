<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–ó–º–µ–π–∫–∞</title>
    <!-- 
        –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
        1. –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ:
           - –†–∞–∑–º–µ—Ä canvas: 800x800 –ø–∏–∫—Å–µ–ª–µ–π
           - –ü–æ–ª–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ –∫–ª–µ—Ç–∫–∏ 20x20 –ø–∏–∫—Å–µ–ª–µ–π
           - –ó–∞—Ü–∏–∫–ª–µ–Ω–Ω–æ–µ –ø–æ–ª–µ (–∑–º–µ–π–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—ã)
           - –¢—ë–º–Ω—ã–π —Ñ–æ–Ω (#1a1a1a) —Å –Ω–µ–æ–Ω–æ–≤–æ–π —Å–µ—Ç–∫–æ–π
        
        2. –ó–º–µ–π–∫–∞:
           - –ù–∞—á–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 3 –∫–ª–µ—Ç–∫–∏
           - –ù–µ–æ–Ω–æ–≤—ã–π –∑–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç (#39ff14)
           - –°–∫–æ—Ä–æ—Å—Ç—å: 8 –∫–ª–µ—Ç–æ–∫ –≤ —Å–µ–∫—É–Ω–¥—É
           - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –ø—Ä–∏ –ø–æ–µ–¥–∞–Ω–∏–∏ –µ–¥—ã
        
        3. –ï–¥–∞:
           - –°–ª—É—á–∞–π–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª–µ
           - –ù–µ–æ–Ω–æ–≤—ã–π —Ä–æ–∑–æ–≤—ã–π —Ü–≤–µ—Ç (#ff1493)
           - –†–∞–∑–º–µ—Ä: –æ–¥–Ω–∞ –∫–ª–µ—Ç–∫–∞
           - –î–∞—ë—Ç 10 –æ—á–∫–æ–≤ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É –Ω–∞ 1
        
        4. –°—É–ø–µ—Ä-–µ–¥–∞:
           - –†–µ–¥–∫–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª–µ (—à–∞–Ω—Å 20% –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –µ–¥—ã)
           - –ù–µ–æ–Ω–æ–≤—ã–π –≥–æ–ª—É–±–æ–π —Ü–≤–µ—Ç (#00ffff)
           - –†–∞–∑–º–µ—Ä: –æ–¥–Ω–∞ –∫–ª–µ—Ç–∫–∞
           - –î–∞—ë—Ç 30 –æ—á–∫–æ–≤ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É –Ω–∞ 2
           - –ò—Å—á–µ–∑–∞–µ—Ç —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥, –µ—Å–ª–∏ –Ω–µ —Å—ä–µ–¥–µ–Ω–∞
        
        5. –ú–∏–Ω—ã:
           - –°–ª—É—á–∞–π–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª–µ (—à–∞–Ω—Å 15% –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –µ–¥—ã)
           - –ù–µ–æ–Ω–æ–≤—ã–π –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç (#ff0000)
           - –†–∞–∑–º–µ—Ä: –æ–¥–Ω–∞ –∫–ª–µ—Ç–∫–∞
           - –ü—Ä–∏ –Ω–∞–µ–∑–¥–µ –Ω–∞ –º–∏–Ω—É - –ø—Ä–æ–∏–≥—Ä—ã—à
           - –ù–∞ –ø–æ–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ 5 –º–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
        
        6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
           - –ö–ª–∞–≤–∏—à–∏ WASD –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫–∏
           - –ü–∞—É–∑–∞ –Ω–∞ –ø—Ä–æ–±–µ–ª
           - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ –Ω–∞ –∫–ª–∞–≤–∏—à—É A
        
        7. –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞:
           - –ó–º–µ–π–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è
           - –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å —Å–æ–±–æ–π –∏–ª–∏ –º–∏–Ω–æ–π = –ø—Ä–æ–∏–≥—Ä—ã—à
           - –°—á—ë—Ç —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–µ–¥–∞–Ω–∏–∏ –µ–¥—ã
           - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
           - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º, –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–º–µ–π–∫–∞ —Å–∞–º–∞ –∏—â–µ—Ç –µ–¥—É –∏ –∏–∑–±–µ–≥–∞–µ—Ç –º–∏–Ω—ã
        
        8. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
           - –°—á—ë—Ç –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
           - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞ –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
           - –°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–∏–≥—Ä—ã—à–µ
           - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é
    -->
    <style>
      body {
        margin: 0;
        background-color: #000;
        min-height: 100vh;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        font-family: 'Courier New', monospace;
        color: #39ff14;
        overflow: hidden;
        padding: 0;
      }

      .game-container {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100vh;
        gap: 20px;
      }

      .canvas-container {
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      canvas {
        border: 2px solid #39ff14;
        box-shadow: 0 0 20px #39ff14;
        background-color: #1a1a1a;
        height: 98vh;
      }

      .game-controls {
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 20px;
        min-width: 200px;
      }

      .controls {
        text-align: left;
        text-shadow: 0 0 5px #39ff14;
        padding: 0 10px;
      }

      .game-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .music-control {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .music-control .game-button {
        flex: 1;
      }

      .radio-link {
        color: #39ff14;
        text-decoration: none;
        font-size: 18px;
        padding: 8px;
        border: 2px solid #39ff14;
        border-radius: 4px;
        background-color: #1a1a1a;
        transition: all 0.3s;
        text-shadow: 0 0 5px #39ff14;
        box-shadow: 0 0 10px #39ff14;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 36px;
        height: 36px;
      }

      .radio-link:hover {
        background-color: #39ff14;
        color: #000;
        transform: scale(1.1);
        box-shadow: 0 0 15px #39ff14;
      }

      .game-button {
        background-color: #1a1a1a;
        color: #39ff14;
        border: 2px solid #39ff14;
        padding: 12px 15px;
        font-family: 'Courier New', monospace;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 0 10px #39ff14;
        transition: all 0.3s;
      }

      .game-button:hover {
        background-color: #39ff14;
        color: #000;
      }

      .game-button.active {
        background-color: #39ff14;
        color: #000;
      }

      .game-stats {
        font-size: 18px;
        text-shadow: 0 0 5px #39ff14;
        margin-bottom: 20px;
      }

      .game-stats div {
        margin-bottom: 10px;
      }

      @media (max-width: 800px) {
        body {
          flex-direction: column;
          overflow-y: auto;
        }

        .game-container {
          flex-direction: column;
          height: auto;
        }

        .canvas-container {
          height: auto;
          width: 100%;
          margin-top: 10px;
        }

        canvas {
          height: auto;
          width: 95vw;
          max-height: 70vh;
        }

        .game-controls {
          width: 100%;
          padding: 10px;
          box-sizing: border-box;
        }

        .game-buttons {
          flex-direction: row;
          flex-wrap: wrap;
          justify-content: center;
        }

        .radio-link {
          font-size: 16px;
          min-width: 32px;
          height: 32px;
        }
      }
    </style>
    <audio
      id="backgroundMusic"
      src="http://stream.srg-ssr.ch/m/rsj/aacp_96"
      preload="none"
      loop
    ></audio>
  </head>
  <body>
    <div class="game-container">
      <div class="canvas-container">
        <canvas id="gameCanvas"></canvas>
      </div>
      <div class="game-controls">
        <div class="game-stats">
          <div id="scoreDisplay">–°—á—ë—Ç: 0</div>
          <div id="modeDisplay">–†–µ–∂–∏–º: –†—É—á–Ω–æ–π</div>
          <div id="speedDisplay">–°–∫–æ—Ä–æ—Å—Ç—å: 8</div>
        </div>
        <div class="game-buttons">
          <button id="autoModeBtn" class="game-button">–ê–≤—Ç–æ—Ä–µ–∂–∏–º: –í–´–ö–õ</button>
          <button id="resetBtn" class="game-button">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
          <button id="pauseBtn" class="game-button">–ü–∞—É–∑–∞</button>
          <div class="music-control">
            <button id="musicBtn" class="game-button">–ú—É–∑—ã–∫–∞: –í–´–ö–õ</button>
            <a
              href="https://www.radioswissjazz.ch/en"
              target="_blank"
              class="radio-link"
              title="Radio Swiss Jazz"
              >üéµ</a
            >
          </div>
        </div>
        <div class="controls">
          <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</p>
          <p>WSD –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫–∏ - –¥–≤–∏–∂–µ–Ω–∏–µ</p>
          <p>–ü—Ä–æ–±–µ–ª - –ø–∞—É–∑–∞</p>
          <p>A - –∞–≤—Ç–æ—Ä–µ–∂–∏–º</p>
          <p>B - –≤–∫–ª/–≤—ã–∫–ª –º—É–∑—ã–∫–∞</p>
        </div>
      </div>
    </div>

    <script>
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
      const GRID_SIZE = 20;
      const GRID_COUNT = 40; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–µ—Ç–æ–∫

      // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä canvas –∏ —Ä–∞–∑–º–µ—Ä –∫–ª–µ—Ç–æ–∫
      function resizeCanvas() {
        const container = document.querySelector('.canvas-container');

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
        let maxHeight, maxWidth;

        if (window.innerWidth > 800) {
          // –î–µ—Å–∫—Ç–æ–ø - –≤—ã—Å–æ—Ç–∞ 98% –æ—Ç –≤—ã—Å–æ—Ç—ã –æ–∫–Ω–∞
          maxHeight = window.innerHeight * 0.98;
          // –®–∏—Ä–∏–Ω–∞ —Å —É—á–µ—Ç–æ–º –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
          maxWidth = (window.innerWidth - 250) * 0.95;
        } else {
          // –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
          maxHeight = window.innerHeight * 0.7;
          maxWidth = window.innerWidth * 0.95;
        }

        // –í—ã—á–∏—Å–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–ª–µ—Ç–∫–∏
        const cellSize = Math.min(
          Math.floor(maxWidth / GRID_COUNT),
          Math.floor(maxHeight / GRID_COUNT)
        );

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä canvas
        canvas.width = cellSize * GRID_COUNT;
        canvas.height = cellSize * GRID_COUNT;

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∫–ª–µ—Ç–∫–∏ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
        CELL_SIZE = cellSize;
      }

      // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∫–ª–µ—Ç–∫–∏
      let CELL_SIZE = GRID_SIZE;

      // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ
      resizeCanvas();

      // –ò –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
      window.addEventListener('resize', () => {
        resizeCanvas();
        if (!isPaused) {
          drawGrid();
          drawSnake();
          drawFood();
          drawSuperFood();
          drawMines();
          drawScore();
          drawModeIndicator();
        }
      });

      // –ù–∞—á–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
      let snake = [
        { x: 10, y: 10 },
        { x: 9, y: 10 },
        { x: 8, y: 10 },
      ];
      let direction = 'right';
      let nextDirection = 'right';
      let superFood = null;
      let superFoodTimer = null;
      let mines = [];
      let food = generateFood();
      let score = 0;
      let speed = 150;
      let gameLoop;
      let isPaused = false;
      let isAutoMode = false;
      let isMusicEnabled = false;

      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–¥—ã –≤ —Å–ª—É—á–∞–π–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
      function generateFood() {
        let newFood;
        do {
          newFood = {
            x: Math.floor(Math.random() * GRID_COUNT),
            y: Math.floor(Math.random() * GRID_COUNT),
          };
        } while (
          snake.some(segment => segment.x === newFood.x && segment.y === newFood.y) ||
          (superFood && superFood.x === newFood.x && superFood.y === newFood.y) ||
          mines.some(mine => mine.x === newFood.x && mine.y === newFood.y)
        );

        // –®–∞–Ω—Å —Å–æ–∑–¥–∞–Ω–∏—è —Å—É–ø–µ—Ä-–µ–¥—ã (20%)
        if (superFood === null && Math.random() < 0.2) {
          superFood = {
            x: Math.floor(Math.random() * GRID_COUNT),
            y: Math.floor(Math.random() * GRID_COUNT),
          };

          // –°—É–ø–µ—Ä-–µ–¥–∞ –∏—Å—á–µ–∑–∞–µ—Ç —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
          clearTimeout(superFoodTimer);
          superFoodTimer = setTimeout(() => {
            superFood = null;
          }, 10000);
        }

        // –®–∞–Ω—Å —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–Ω—ã (15%), –Ω–æ –Ω–µ –±–æ–ª–µ–µ 5 –Ω–∞ –ø–æ–ª–µ
        if (mines.length < 5 && Math.random() < 0.15) {
          let newMine;
          do {
            newMine = {
              x: Math.floor(Math.random() * GRID_COUNT),
              y: Math.floor(Math.random() * GRID_COUNT),
            };
          } while (
            snake.some(segment => segment.x === newMine.x && segment.y === newMine.y) ||
            (superFood && superFood.x === newMine.x && superFood.y === newMine.y) ||
            mines.some(mine => mine.x === newMine.x && mine.y === newMine.y) ||
            (newFood.x === newMine.x && newFood.y === newMine.y)
          );
          mines.push(newMine);
        }

        return newFood;
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏
      function drawGrid() {
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 0.5;

        for (let i = 0; i <= GRID_COUNT; i++) {
          ctx.beginPath();
          ctx.moveTo(i * CELL_SIZE, 0);
          ctx.lineTo(i * CELL_SIZE, canvas.height);
          ctx.stroke();

          ctx.beginPath();
          ctx.moveTo(0, i * CELL_SIZE);
          ctx.lineTo(canvas.width, i * CELL_SIZE);
          ctx.stroke();
        }
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–º–µ–π–∫–∏
      function drawSnake() {
        snake.forEach((segment, index) => {
          ctx.fillStyle = '#39ff14';
          ctx.shadowColor = '#39ff14';
          ctx.shadowBlur = 10;
          ctx.fillRect(
            segment.x * CELL_SIZE,
            segment.y * CELL_SIZE,
            CELL_SIZE - 1,
            CELL_SIZE - 1
          );

          // –†–∏—Å—É–µ–º –≥–ª–∞–∑–∞ –Ω–∞ –≥–æ–ª–æ–≤–µ –∑–º–µ–π–∫–∏
          if (index === 0) {
            ctx.fillStyle = '#000';
            const eyeSize = Math.max(2, CELL_SIZE * 0.2);
            const eyeOffset = Math.max(2, CELL_SIZE * 0.25);

            if (direction === 'right' || direction === 'left') {
              ctx.fillRect(
                segment.x * CELL_SIZE +
                  (direction === 'right' ? CELL_SIZE * 0.6 : CELL_SIZE * 0.2),
                segment.y * CELL_SIZE + CELL_SIZE * 0.2,
                eyeSize,
                eyeSize
              );
              ctx.fillRect(
                segment.x * CELL_SIZE +
                  (direction === 'right' ? CELL_SIZE * 0.6 : CELL_SIZE * 0.2),
                segment.y * CELL_SIZE + CELL_SIZE * 0.6,
                eyeSize,
                eyeSize
              );
            } else {
              ctx.fillRect(
                segment.x * CELL_SIZE + CELL_SIZE * 0.2,
                segment.y * CELL_SIZE +
                  (direction === 'down' ? CELL_SIZE * 0.6 : CELL_SIZE * 0.2),
                eyeSize,
                eyeSize
              );
              ctx.fillRect(
                segment.x * CELL_SIZE + CELL_SIZE * 0.6,
                segment.y * CELL_SIZE +
                  (direction === 'down' ? CELL_SIZE * 0.6 : CELL_SIZE * 0.2),
                eyeSize,
                eyeSize
              );
            }
          }
        });
        ctx.shadowBlur = 0;
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –µ–¥—ã
      function drawFood() {
        ctx.fillStyle = '#ff1493';
        ctx.shadowColor = '#ff1493';
        ctx.shadowBlur = 10;
        ctx.beginPath();
        ctx.arc(
          food.x * CELL_SIZE + CELL_SIZE / 2,
          food.y * CELL_SIZE + CELL_SIZE / 2,
          CELL_SIZE / 2 - 1,
          0,
          Math.PI * 2
        );
        ctx.fill();
        ctx.shadowBlur = 0;
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—É–ø–µ—Ä-–µ–¥—ã
      function drawSuperFood() {
        if (superFood) {
          ctx.fillStyle = '#00ffff';
          ctx.shadowColor = '#00ffff';
          ctx.shadowBlur = 15;
          ctx.beginPath();
          ctx.arc(
            superFood.x * CELL_SIZE + CELL_SIZE / 2,
            superFood.y * CELL_SIZE + CELL_SIZE / 2,
            CELL_SIZE / 2,
            0,
            Math.PI * 2
          );
          ctx.fill();

          // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—è–Ω–∏–µ –≤–æ–∫—Ä—É–≥ —Å—É–ø–µ—Ä-–µ–¥—ã
          ctx.strokeStyle = '#00ffff';
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.arc(
            superFood.x * CELL_SIZE + CELL_SIZE / 2,
            superFood.y * CELL_SIZE + CELL_SIZE / 2,
            CELL_SIZE / 2 + 3,
            0,
            Math.PI * 2
          );
          ctx.stroke();
          ctx.shadowBlur = 0;
        }
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–∏–Ω
      function drawMines() {
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#ff0000';
        ctx.fillStyle = '#ff0000';

        mines.forEach(mine => {
          // –†–∏—Å—É–µ–º –æ—Å–Ω–æ–≤—É –º–∏–Ω—ã
          ctx.beginPath();
          ctx.arc(
            mine.x * CELL_SIZE + CELL_SIZE / 2,
            mine.y * CELL_SIZE + CELL_SIZE / 2,
            CELL_SIZE / 2 - 2,
            0,
            Math.PI * 2
          );
          ctx.fill();

          // –†–∏—Å—É–µ–º "—à–∏–ø—ã" –º–∏–Ω—ã
          ctx.strokeStyle = '#ff0000';
          ctx.lineWidth = 2;

          // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
          ctx.beginPath();
          ctx.moveTo(mine.x * CELL_SIZE + 2, mine.y * CELL_SIZE + CELL_SIZE / 2);
          ctx.lineTo(
            mine.x * CELL_SIZE + CELL_SIZE - 2,
            mine.y * CELL_SIZE + CELL_SIZE / 2
          );
          ctx.stroke();

          // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
          ctx.beginPath();
          ctx.moveTo(mine.x * CELL_SIZE + CELL_SIZE / 2, mine.y * CELL_SIZE + 2);
          ctx.lineTo(
            mine.x * CELL_SIZE + CELL_SIZE / 2,
            mine.y * CELL_SIZE + CELL_SIZE - 2
          );
          ctx.stroke();

          // –î–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
          ctx.beginPath();
          ctx.moveTo(
            mine.x * CELL_SIZE + CELL_SIZE / 4,
            mine.y * CELL_SIZE + CELL_SIZE / 4
          );
          ctx.lineTo(
            mine.x * CELL_SIZE + (CELL_SIZE * 3) / 4,
            mine.y * CELL_SIZE + (CELL_SIZE * 3) / 4
          );
          ctx.stroke();

          ctx.beginPath();
          ctx.moveTo(
            mine.x * CELL_SIZE + (CELL_SIZE * 3) / 4,
            mine.y * CELL_SIZE + CELL_SIZE / 4
          );
          ctx.lineTo(
            mine.x * CELL_SIZE + CELL_SIZE / 4,
            mine.y * CELL_SIZE + (CELL_SIZE * 3) / 4
          );
          ctx.stroke();
        });

        ctx.shadowBlur = 0;
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—á—ë—Ç–∞
      function drawScore() {
        document.getElementById('scoreDisplay').textContent = `–°—á—ë—Ç: ${score}`;
      }

      // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
      function drawModeIndicator() {
        document.getElementById('modeDisplay').textContent =
          `–†–µ–∂–∏–º: ${isAutoMode ? '–ê–≤—Ç–æ' : '–†—É—á–Ω–æ–π'}`;
      }

      // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
      function drawSpeed() {
        const speedValue = Math.round(1000 / speed);
        document.getElementById('speedDisplay').textContent = `–°–∫–æ—Ä–æ—Å—Ç—å: ${speedValue}`;
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
      function update() {
        const head = { x: snake[0].x, y: snake[0].y };
        direction = nextDirection;

        switch (direction) {
          case 'up':
            head.y--;
            break;
          case 'down':
            head.y++;
            break;
          case 'left':
            head.x--;
            break;
          case 'right':
            head.x++;
            break;
        }

        // –ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ –ø–æ–ª—è
        head.x = (head.x + GRID_COUNT) % GRID_COUNT;
        head.y = (head.y + GRID_COUNT) % GRID_COUNT;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–æ–±–æ–π
        if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
          gameOver();
          return;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –º–∏–Ω–æ–π
        if (mines.some(mine => mine.x === head.x && mine.y === head.y)) {
          gameOver();
          return;
        }

        snake.unshift(head);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–µ–¥–∞–Ω–∏—è –µ–¥—ã
        if (head.x === food.x && head.y === food.y) {
          score += 10;
          food = generateFood();
          speed = Math.max(50, speed - 2); // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
          clearInterval(gameLoop);
          gameLoop = setInterval(gameStep, speed);
        }
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–µ–¥–∞–Ω–∏—è —Å—É–ø–µ—Ä-–µ–¥—ã
        else if (superFood && head.x === superFood.x && head.y === superFood.y) {
          score += 30;
          // –°—É–ø–µ—Ä-–µ–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç 2 —Å–µ–≥–º–µ–Ω—Ç–∞, –ø–æ—ç—Ç–æ–º—É –Ω–µ —É–¥–∞–ª—è–µ–º —Ö–≤–æ—Å—Ç –≤ —ç—Ç–æ–º —Ö–æ–¥—É –∏ —Å–ª–µ–¥—É—é—â–µ–º
          clearTimeout(superFoodTimer);
          superFood = null;
          // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å —á—É—Ç—å –±–æ–ª—å—à–µ
          speed = Math.max(50, speed - 4);
          clearInterval(gameLoop);
          gameLoop = setInterval(gameStep, speed);

          // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π —Å–µ–≥–º–µ–Ω—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
          setTimeout(() => {
            if (gameLoop) {
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–≥—Ä–∞ –≤—Å–µ –µ—â–µ –∏–¥–µ—Ç
              // –ù–µ —É–¥–∞–ª—è–µ–º —Ö–≤–æ—Å—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
              snake.push({ ...snake[snake.length - 1] });
            }
          }, speed);
        } else {
          snake.pop();
        }
      }

      // –û–¥–∏–Ω —à–∞–≥ –∏–≥—Ä—ã
      function gameStep() {
        if (!isPaused) {
          if (isAutoMode) {
            autoControl();
          }
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          drawGrid();
          update();
          drawFood();
          drawSuperFood();
          drawMines();
          drawSnake();
          drawScore();
          drawModeIndicator();
          drawSpeed();
        }
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
      function gameOver() {
        clearInterval(gameLoop);
        ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = '#39ff14';
        const fontSize = Math.max(24, canvas.width / 20);
        ctx.font = `${fontSize * 2}px "Courier New"`;
        ctx.textAlign = 'center';
        ctx.fillText('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!', canvas.width / 2, canvas.height / 2 - fontSize);

        ctx.font = `${fontSize}px "Courier New"`;
        ctx.fillText(
          `–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: ${score}`,
          canvas.width / 2,
          canvas.height / 2 + fontSize
        );
        ctx.fillText(
          '–ù–∞–∂–º–∏—Ç–µ –ø—Ä–æ–±–µ–ª –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã',
          canvas.width / 2,
          canvas.height / 2 + fontSize * 2.5
        );

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
        isAutoMode = false;
        autoModeBtn.textContent = '–ê–≤—Ç–æ—Ä–µ–∂–∏–º: –í–´–ö–õ';
        autoModeBtn.classList.remove('active');

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞—É–∑—É
        isPaused = false;
        pauseBtn.textContent = '–ü–∞—É–∑–∞';
        pauseBtn.classList.remove('active');

        gameLoop = null;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ DOM
        drawScore();
        drawModeIndicator();
        drawSpeed();
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à
      document.addEventListener('keydown', e => {
        if (e.code === 'Space') {
          if (gameLoop) {
            isPaused = !isPaused;
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–∞—É–∑—ã
            pauseBtn.textContent = isPaused ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–ü–∞—É–∑–∞';
            pauseBtn.classList.toggle('active', isPaused);
          } else {
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
            snake = [
              { x: 10, y: 10 },
              { x: 9, y: 10 },
              { x: 8, y: 10 },
            ];
            direction = 'right';
            nextDirection = 'right';
            score = 0;
            speed = 150;
            food = generateFood();
            superFood = null;
            mines = [];
            isPaused = false;
            gameLoop = setInterval(gameStep, speed);
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–∞—É–∑—ã –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
            pauseBtn.textContent = '–ü–∞—É–∑–∞';
            pauseBtn.classList.remove('active');
          }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ –ø–æ –∫–ª–∞–≤–∏—à–µ A
        if (e.code === 'KeyA' && gameLoop) {
          isAutoMode = !isAutoMode;
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
          autoModeBtn.textContent = `–ê–≤—Ç–æ—Ä–µ–∂–∏–º: ${isAutoMode ? '–í–ö–õ' : '–í–´–ö–õ'}`;
          autoModeBtn.classList.toggle('active', isAutoMode);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –ø–æ –∫–ª–∞–≤–∏—à–µ B
        if (e.code === 'KeyB') {
          toggleBackgroundMusic();
        }

        if (!isPaused && !isAutoMode) {
          // –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ
          switch (e.code) {
            case 'ArrowUp':
            case 'KeyW':
              if (direction !== 'down') nextDirection = 'up';
              break;
            case 'ArrowDown':
            case 'KeyS':
              if (direction !== 'up') nextDirection = 'down';
              break;
            case 'ArrowLeft':
              if (direction !== 'right') nextDirection = 'left';
              break;
            case 'ArrowRight':
            case 'KeyD':
              if (direction !== 'left') nextDirection = 'right';
              break;
          }
        }
      });

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–º–µ–π–∫–æ–π
      function autoControl() {
        if (!isAutoMode) return;

        const head = snake[0];

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –µ–¥–µ
        let newDirection = direction;

        // –î–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è —Å–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –±–ª–∏–∂–∞–π—à—É—é –µ–¥—É (–æ–±—ã—á–Ω—É—é –∏–ª–∏ —Å—É–ø–µ—Ä-–µ–¥—É)
        let targetFood = food;
        let targetX = food.x;
        let targetY = food.y;

        // –ï—Å–ª–∏ –µ—Å—Ç—å —Å—É–ø–µ—Ä-–µ–¥–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–Ω–∞ –±–ª–∏–∂–µ –æ–±—ã—á–Ω–æ–π
        if (superFood) {
          const distToFood = getDistance(head, food);
          const distToSuperFood = getDistance(head, superFood);

          if (distToSuperFood < distToFood) {
            targetFood = superFood;
            targetX = superFood.x;
            targetY = superFood.y;
          }
        }

        // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–∏—Ü—É –ø–æ X –∏ Y —Å —É—á–µ—Ç–æ–º –∑–∞—Ü–∏–∫–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—è
        let dx = targetX - head.x;
        let dy = targetY - head.y;

        // –£—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—Ü–∏–∫–ª–µ–Ω–Ω–æ–µ –ø–æ–ª–µ
        if (Math.abs(dx) > GRID_COUNT / 2) {
          dx = dx > 0 ? dx - GRID_COUNT : dx + GRID_COUNT;
        }
        if (Math.abs(dy) > GRID_COUNT / 2) {
          dy = dy > 0 ? dy - GRID_COUNT : dy + GRID_COUNT;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–∏–Ω –ø–æ –ø—É—Ç–∏ –∏ –∏–∑–±–µ–≥–∞–µ–º –∏—Ö
        let dangerousMine = null;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –µ—Å—Ç—å –ª–∏ –º–∏–Ω–∞ –≤ –¥–∞–Ω–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
        function hasMineInDirection(dir) {
          let checkX = head.x;
          let checkY = head.y;

          switch (dir) {
            case 'up':
              checkY = (head.y - 1 + GRID_COUNT) % GRID_COUNT;
              break;
            case 'down':
              checkY = (head.y + 1 + GRID_COUNT) % GRID_COUNT;
              break;
            case 'left':
              checkX = (head.x - 1 + GRID_COUNT) % GRID_COUNT;
              break;
            case 'right':
              checkX = (head.x + 1 + GRID_COUNT) % GRID_COUNT;
              break;
          }

          return mines.some(mine => mine.x === checkX && mine.y === checkY);
        }

        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è –ø–æ X –∏–ª–∏ Y —Å —É—á–µ—Ç–æ–º –º–∏–Ω
        if (Math.abs(dx) > Math.abs(dy)) {
          // –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ X
          newDirection = dx < 0 ? 'left' : 'right';

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–∏–Ω—ã –≤ —ç—Ç–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
          if (hasMineInDirection(newDirection)) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –º–∏–Ω–∞, –ø—Ä–æ–±—É–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –ø–æ Y
            newDirection = dy < 0 ? 'up' : 'down';

            // –ï—Å–ª–∏ –∏ —Ç–∞–º –º–∏–Ω–∞, –∏—â–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            if (hasMineInDirection(newDirection)) {
              newDirection = findSafePath(head);
            }
          }
        } else {
          // –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ Y
          newDirection = dy < 0 ? 'up' : 'down';

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–∏–Ω—ã –≤ —ç—Ç–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
          if (hasMineInDirection(newDirection)) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –º–∏–Ω–∞, –ø—Ä–æ–±—É–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –ø–æ X
            newDirection = dx < 0 ? 'left' : 'right';

            // –ï—Å–ª–∏ –∏ —Ç–∞–º –º–∏–Ω–∞, –∏—â–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            if (hasMineInDirection(newDirection)) {
              newDirection = findSafePath(head);
            }
          }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –ª–∏ –Ω–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—é
        let nextHeadX, nextHeadY;
        switch (newDirection) {
          case 'up':
            nextHeadX = head.x;
            nextHeadY = (head.y - 1 + GRID_COUNT) % GRID_COUNT;
            break;
          case 'down':
            nextHeadX = head.x;
            nextHeadY = (head.y + 1 + GRID_COUNT) % GRID_COUNT;
            break;
          case 'left':
            nextHeadX = (head.x - 1 + GRID_COUNT) % GRID_COUNT;
            nextHeadY = head.y;
            break;
          case 'right':
            nextHeadX = (head.x + 1 + GRID_COUNT) % GRID_COUNT;
            nextHeadY = head.y;
            break;
        }

        // –ï—Å–ª–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –∏–ª–∏ –º–∏–Ω–∞, –∏—â–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        if (
          willCollideWithSelf(nextHeadX, nextHeadY) ||
          mines.some(mine => mine.x === nextHeadX && mine.y === nextHeadY)
        ) {
          newDirection = findSafePath(head);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ —Ç–µ–∫—É—â–µ–º—É
        if (
          (direction === 'up' && newDirection === 'down') ||
          (direction === 'down' && newDirection === 'up') ||
          (direction === 'left' && newDirection === 'right') ||
          (direction === 'right' && newDirection === 'left')
        ) {
          return;
        }

        nextDirection = newDirection;
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø—É—Ç–∏
      function findSafePath(head) {
        const safeDirections = [];

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        if (direction !== 'down') {
          const upY = (head.y - 1 + GRID_COUNT) % GRID_COUNT;
          if (
            !willCollideWithSelf(head.x, upY) &&
            !mines.some(mine => mine.x === head.x && mine.y === upY)
          ) {
            safeDirections.push('up');
          }
        }

        if (direction !== 'up') {
          const downY = (head.y + 1 + GRID_COUNT) % GRID_COUNT;
          if (
            !willCollideWithSelf(head.x, downY) &&
            !mines.some(mine => mine.x === head.x && mine.y === downY)
          ) {
            safeDirections.push('down');
          }
        }

        if (direction !== 'right') {
          const leftX = (head.x - 1 + GRID_COUNT) % GRID_COUNT;
          if (
            !willCollideWithSelf(leftX, head.y) &&
            !mines.some(mine => mine.x === leftX && mine.y === head.y)
          ) {
            safeDirections.push('left');
          }
        }

        if (direction !== 'left') {
          const rightX = (head.x + 1 + GRID_COUNT) % GRID_COUNT;
          if (
            !willCollideWithSelf(rightX, head.y) &&
            !mines.some(mine => mine.x === rightX && mine.y === head.y)
          ) {
            safeDirections.push('right');
          }
        }

        // –ï—Å–ª–∏ –µ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ
        if (safeDirections.length > 0) {
          return safeDirections[Math.floor(Math.random() * safeDirections.length)];
        }

        // –ï—Å–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–µ—Ç, –æ—Å—Ç–∞–µ–º—Å—è –≤ —Ç–µ–∫—É—â–µ–º
        return direction;
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ —Å —É—á–µ—Ç–æ–º –∑–∞—Ü–∏–∫–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—è
      function getDistance(point1, point2) {
        let dx = Math.abs(point1.x - point2.x);
        let dy = Math.abs(point1.y - point2.y);

        // –£—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—Ü–∏–∫–ª–µ–Ω–Ω–æ–µ –ø–æ–ª–µ
        dx = Math.min(dx, GRID_COUNT - dx);
        dy = Math.min(dy, GRID_COUNT - dy);

        return dx + dy; // –ú–∞–Ω—Ö—ç—Ç—Ç–µ–Ω—Å–∫–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–æ–±–æ–π
      function willCollideWithSelf(x, y) {
        return snake.some((segment, index) => {
          // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏—Å—á–µ–∑–Ω–µ—Ç –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏
          if (index === snake.length - 1) return false;
          return segment.x === x && segment.y === y;
        });
      }

      // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
      gameLoop = setInterval(gameStep, speed);

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
      const autoModeBtn = document.getElementById('autoModeBtn');
      const resetBtn = document.getElementById('resetBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const musicBtn = document.getElementById('musicBtn');
      const backgroundMusic = document.getElementById('backgroundMusic');

      autoModeBtn.addEventListener('click', () => {
        isAutoMode = !isAutoMode;
        autoModeBtn.textContent = `–ê–≤—Ç–æ—Ä–µ–∂–∏–º: ${isAutoMode ? '–í–ö–õ' : '–í–´–ö–õ'}`;
        autoModeBtn.classList.toggle('active', isAutoMode);
        drawModeIndicator();
      });

      resetBtn.addEventListener('click', () => {
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        clearInterval(gameLoop);
        clearTimeout(superFoodTimer);
        snake = [
          { x: 10, y: 10 },
          { x: 9, y: 10 },
          { x: 8, y: 10 },
        ];
        direction = 'right';
        nextDirection = 'right';
        score = 0;
        speed = 150;
        food = generateFood();
        superFood = null;
        mines = [];
        isPaused = false;
        pauseBtn.textContent = '–ü–∞—É–∑–∞';
        pauseBtn.classList.remove('active');
        gameLoop = setInterval(gameStep, speed);
        drawScore();
        drawSpeed();
      });

      pauseBtn.addEventListener('click', () => {
        isPaused = !isPaused;
        pauseBtn.textContent = isPaused ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–ü–∞—É–∑–∞';
        pauseBtn.classList.toggle('active', isPaused);
      });

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
      function toggleBackgroundMusic() {
        isMusicEnabled = !isMusicEnabled;

        if (isMusicEnabled) {
          backgroundMusic.volume = 0.3; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏—Ö—É—é –≥—Ä–æ–º–∫–æ—Å—Ç—å
          backgroundMusic.play().catch(e => {
            console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –º—É–∑—ã–∫–∏:', e);
            isMusicEnabled = false;
          });
        } else {
          backgroundMusic.pause();
        }

        musicBtn.textContent = `–ú—É–∑—ã–∫–∞: ${isMusicEnabled ? '–í–ö–õ' : '–í–´–ö–õ'}`;
        musicBtn.classList.toggle('active', isMusicEnabled);
      }

      musicBtn.addEventListener('click', toggleBackgroundMusic);
    </script>
  </body>
</html>
