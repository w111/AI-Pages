<!DOCTYPE html>
<!--
ТЕХНИЧЕСКОЕ ЗАДАНИЕ

Цель: Создать интерактивный трекер криптовалют с виртуальным портфелем.

Функциональные требования:
1. Отображение курсов криптовалют:
   - Получение данных через CoinGecko API
   - Таблица с топ-криптовалютами
   - Поиск по криптовалютам
   - Сортировка по различным параметрам

2. Виртуальный портфель:
   - Добавление монет в портфель
   - Указание количества и цены покупки
   - Расчет текущей стоимости
   - P&L калькулятор (прибыль/убыток)

3. Графики цен:
   - Исторические данные за 7/30/90 дней
   - Интерактивные графики с Chart.js
   - Отображение объема торгов

4. Уведомления о цене:
   - Установка целевой цены
   - Браузерные уведомления при достижении
   - Сохранение алертов в localStorage

5. Пользовательский интерфейс:
   - Темная и светлая тема
   - Многоязычность (русский/английский)
   - Адаптивный дизайн
   - Сохранение настроек в localStorage

Технические требования:
1. CoinGecko API (api.coingecko.com)
2. Chart.js для графиков
3. Vanilla JavaScript без фреймворков
4. Кэширование данных в localStorage
5. Адаптивный CSS
-->
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Крипто Трекер | Crypto Tracker</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-color: #f0f4f8;
      --text-color: #1a202c;
      --card-bg: #ffffff;
      --border-color: #e2e8f0;
      --primary-color: #f7931a;
      --primary-hover: #e8850f;
      --secondary-color: #718096;
      --input-bg: #ffffff;
      --input-border: #cbd5e0;
      --success-color: #38a169;
      --danger-color: #e53e3e;
      --warning-color: #d69e2e;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    [data-theme="dark"] {
      --bg-color: #1a202c;
      --text-color: #e2e8f0;
      --card-bg: #2d3748;
      --border-color: #4a5568;
      --primary-color: #f7931a;
      --primary-hover: #ffa940;
      --secondary-color: #a0aec0;
      --input-bg: #2d3748;
      --input-border: #4a5568;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      transition: background-color 0.3s ease, color 0.3s ease;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: var(--primary-color);
    }

    h1 i {
      margin-right: 10px;
    }

    .subtitle {
      color: var(--secondary-color);
      font-size: 1.1rem;
    }

    /* Settings button */
    .settings-button {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background-color: var(--card-bg);
      border: 1px solid var(--border-color);
      color: var(--primary-color);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .settings-button:hover {
      transform: rotate(45deg);
    }

    /* Settings modal */
    .settings-modal {
      display: none;
      position: fixed;
      top: 75px;
      right: 20px;
      background-color: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow-lg);
      z-index: 999;
      min-width: 250px;
      border: 1px solid var(--border-color);
    }

    .settings-modal.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .settings-title {
      font-size: 1.2rem;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }

    .settings-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .settings-option label {
      font-size: 0.95rem;
      cursor: pointer;
    }

    /* Toggle switch */
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 26px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--primary-color);
    }

    input:checked + .slider:before {
      transform: translateX(24px);
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .tab-btn {
      padding: 12px 25px;
      border: 2px solid var(--border-color);
      background-color: var(--card-bg);
      color: var(--text-color);
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .tab-btn.active {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    /* Cards */
    .card {
      background-color: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
      margin-bottom: 25px;
    }

    .card-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--primary-color);
    }

    /* Market overview */
    .market-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: bold;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    /* Search and filters */
    .search-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 200px;
      padding: 12px 15px;
      border: 2px solid var(--input-border);
      border-radius: 8px;
      font-size: 1rem;
      background-color: var(--input-bg);
      color: var(--text-color);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    /* Crypto table */
    .crypto-table-container {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }

    .crypto-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }

    .crypto-table th,
    .crypto-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .crypto-table th {
      background-color: var(--primary-color);
      color: white;
      position: sticky;
      top: 0;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
    }

    .crypto-table th:hover {
      background-color: var(--primary-hover);
    }

    .crypto-table tr:hover {
      background-color: var(--bg-color);
    }

    .crypto-name {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .crypto-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
    }

    .crypto-symbol {
      color: var(--secondary-color);
      font-size: 0.85rem;
      text-transform: uppercase;
    }

    .price-change {
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .price-up {
      color: var(--success-color);
      background-color: rgba(56, 161, 105, 0.1);
    }

    .price-down {
      color: var(--danger-color);
      background-color: rgba(229, 62, 62, 0.1);
    }

    .action-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-hover);
    }

    .btn-secondary {
      background-color: var(--border-color);
      color: var(--text-color);
    }

    .btn-secondary:hover {
      background-color: var(--secondary-color);
      color: white;
    }

    .btn-danger {
      background-color: var(--danger-color);
      color: white;
    }

    .btn-danger:hover {
      opacity: 0.9;
    }

    /* Portfolio */
    .portfolio-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .summary-card {
      background-color: var(--bg-color);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .summary-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary-color);
    }

    .summary-label {
      font-size: 0.9rem;
      color: var(--secondary-color);
    }

    .profit {
      color: var(--success-color) !important;
    }

    .loss {
      color: var(--danger-color) !important;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background-color: var(--card-bg);
      border-radius: 12px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 1.3rem;
      color: var(--primary-color);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--secondary-color);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--input-border);
      border-radius: 8px;
      font-size: 1rem;
      background-color: var(--input-bg);
      color: var(--text-color);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    /* Chart */
    .chart-container {
      position: relative;
      height: 400px;
      margin-top: 20px;
    }

    .chart-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .chart-btn {
      padding: 8px 15px;
      border: 2px solid var(--border-color);
      background-color: var(--card-bg);
      color: var(--text-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .chart-btn:hover,
    .chart-btn.active {
      border-color: var(--primary-color);
      background-color: var(--primary-color);
      color: white;
    }

    /* Alerts */
    .alert-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background-color: var(--bg-color);
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .alert-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .alert-coin {
      font-weight: bold;
    }

    .alert-target {
      color: var(--secondary-color);
    }

    .alert-type {
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    .alert-above {
      background-color: rgba(56, 161, 105, 0.2);
      color: var(--success-color);
    }

    .alert-below {
      background-color: rgba(229, 62, 62, 0.2);
      color: var(--danger-color);
    }

    /* Loading & Error */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--secondary-color);
    }

    .loading i {
      font-size: 3rem;
      animation: spin 1s linear infinite;
      color: var(--primary-color);
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .error {
      text-align: center;
      padding: 40px;
      color: var(--danger-color);
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--secondary-color);
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      color: var(--secondary-color);
      font-size: 0.9rem;
    }

    footer a {
      color: var(--primary-color);
      text-decoration: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
      h1 {
        font-size: 1.8rem;
      }

      .tabs {
        flex-direction: column;
      }

      .tab-btn {
        width: 100%;
        justify-content: center;
      }

      .market-stats {
        grid-template-columns: 1fr 1fr;
      }

      .portfolio-summary {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 10px;
      }

      .market-stats {
        grid-template-columns: 1fr;
      }

      .portfolio-summary {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Settings button -->
  <button class="settings-button" id="settingsButton" aria-label="Settings">
    <i class="fas fa-cog"></i>
  </button>

  <!-- Settings modal -->
  <div class="settings-modal" id="settingsModal">
    <h3 class="settings-title" data-i18n="settings">Настройки</h3>
    <div class="settings-option">
      <label for="themeSwitch" data-i18n="darkTheme">Темная тема</label>
      <label class="toggle-switch">
        <input type="checkbox" id="themeSwitch">
        <span class="slider"></span>
      </label>
    </div>
    <div class="settings-option">
      <label for="langSwitch" data-i18n="english">English</label>
      <label class="toggle-switch">
        <input type="checkbox" id="langSwitch">
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <div class="container">
    <header>
      <h1><i class="fab fa-bitcoin"></i><span data-i18n="title">Крипто Трекер</span></h1>
      <p class="subtitle" data-i18n="subtitle">Отслеживайте криптовалюты и управляйте портфелем</p>
    </header>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="market">
        <i class="fas fa-chart-line"></i>
        <span data-i18n="tabMarket">Рынок</span>
      </button>
      <button class="tab-btn" data-tab="portfolio">
        <i class="fas fa-wallet"></i>
        <span data-i18n="tabPortfolio">Портфель</span>
      </button>
      <button class="tab-btn" data-tab="charts">
        <i class="fas fa-chart-area"></i>
        <span data-i18n="tabCharts">Графики</span>
      </button>
      <button class="tab-btn" data-tab="alerts">
        <i class="fas fa-bell"></i>
        <span data-i18n="tabAlerts">Уведомления</span>
      </button>
    </div>

    <!-- Market Tab -->
    <div class="tab-content active" id="market">
      <div class="market-stats" id="marketStats">
        <div class="stat-card">
          <div class="stat-value" id="totalMarketCap">-</div>
          <div class="stat-label" data-i18n="marketCap">Капитализация</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalVolume">-</div>
          <div class="stat-label" data-i18n="volume24h">Объем 24ч</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="btcDominance">-</div>
          <div class="stat-label" data-i18n="btcDominance">BTC Доминация</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="activeCryptos">-</div>
          <div class="stat-label" data-i18n="activeCryptos">Активных монет</div>
        </div>
      </div>

      <div class="card">
        <div class="search-bar">
          <input type="text" class="search-input" id="searchCrypto"
                 data-i18n-placeholder="searchPlaceholder" placeholder="Поиск криптовалюты...">
        </div>
        <div class="crypto-table-container" id="cryptoTableContainer">
          <div class="loading">
            <i class="fas fa-spinner"></i>
            <p data-i18n="loading">Загрузка...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Tab -->
    <div class="tab-content" id="portfolio">
      <div class="portfolio-summary" id="portfolioSummary">
        <div class="summary-card">
          <div class="summary-value" id="portfolioValue">$0.00</div>
          <div class="summary-label" data-i18n="totalValue">Общая стоимость</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" id="portfolioCost">$0.00</div>
          <div class="summary-label" data-i18n="totalCost">Вложено</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" id="portfolioPnL">$0.00</div>
          <div class="summary-label" data-i18n="profitLoss">Прибыль/Убыток</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" id="portfolioPnLPercent">0%</div>
          <div class="summary-label" data-i18n="pnlPercent">% изменения</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">
          <i class="fas fa-coins"></i>
          <span data-i18n="myPortfolio">Мой портфель</span>
          <button class="action-btn btn-primary" id="addAssetBtn" style="margin-left: auto;">
            <i class="fas fa-plus"></i> <span data-i18n="addAsset">Добавить</span>
          </button>
        </div>
        <div id="portfolioList">
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <p data-i18n="emptyPortfolio">Портфель пуст. Добавьте криптовалюту для отслеживания.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Tab -->
    <div class="tab-content" id="charts">
      <div class="card">
        <div class="card-title">
          <i class="fas fa-chart-area"></i>
          <span data-i18n="priceChart">График цены</span>
        </div>
        <div class="search-bar">
          <select id="chartCoinSelect" class="search-input" style="flex: none; min-width: 200px;">
            <option value="bitcoin">Bitcoin (BTC)</option>
            <option value="ethereum">Ethereum (ETH)</option>
            <option value="tether">Tether (USDT)</option>
            <option value="binancecoin">BNB</option>
            <option value="solana">Solana (SOL)</option>
          </select>
        </div>
        <div class="chart-controls">
          <button class="chart-btn active" data-days="7">7D</button>
          <button class="chart-btn" data-days="30">30D</button>
          <button class="chart-btn" data-days="90">90D</button>
          <button class="chart-btn" data-days="365">1Y</button>
        </div>
        <div class="chart-container">
          <canvas id="priceChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Alerts Tab -->
    <div class="tab-content" id="alerts">
      <div class="card">
        <div class="card-title">
          <i class="fas fa-bell"></i>
          <span data-i18n="priceAlerts">Ценовые уведомления</span>
          <button class="action-btn btn-primary" id="addAlertBtn" style="margin-left: auto;">
            <i class="fas fa-plus"></i> <span data-i18n="addAlert">Добавить</span>
          </button>
        </div>
        <div id="alertsList">
          <div class="empty-state">
            <i class="fas fa-bell-slash"></i>
            <p data-i18n="emptyAlerts">Нет активных уведомлений</p>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p data-i18n="dataSource">Данные предоставлены</p>
      <a href="https://www.coingecko.com" target="_blank" rel="noopener">CoinGecko API</a>
    </footer>
  </div>

  <!-- Add Asset Modal -->
  <div class="modal-overlay" id="addAssetModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" data-i18n="addToPortfolio">Добавить в портфель</h3>
        <button class="modal-close" id="closeAssetModal">&times;</button>
      </div>
      <form id="addAssetForm">
        <div class="form-group">
          <label data-i18n="selectCoin">Выберите монету</label>
          <select id="assetCoinSelect" required>
            <option value="">-- Выберите --</option>
          </select>
        </div>
        <div class="form-group">
          <label data-i18n="quantity">Количество</label>
          <input type="number" id="assetQuantity" step="any" min="0" required>
        </div>
        <div class="form-group">
          <label data-i18n="buyPrice">Цена покупки ($)</label>
          <input type="number" id="assetBuyPrice" step="any" min="0" required>
        </div>
        <button type="submit" class="action-btn btn-primary" style="width: 100%;">
          <i class="fas fa-plus"></i> <span data-i18n="add">Добавить</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Add Alert Modal -->
  <div class="modal-overlay" id="addAlertModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" data-i18n="createAlert">Создать уведомление</h3>
        <button class="modal-close" id="closeAlertModal">&times;</button>
      </div>
      <form id="addAlertForm">
        <div class="form-group">
          <label data-i18n="selectCoin">Выберите монету</label>
          <select id="alertCoinSelect" required>
            <option value="">-- Выберите --</option>
          </select>
        </div>
        <div class="form-group">
          <label data-i18n="alertType">Тип уведомления</label>
          <select id="alertType" required>
            <option value="above" data-i18n="priceAbove">Цена выше</option>
            <option value="below" data-i18n="priceBelow">Цена ниже</option>
          </select>
        </div>
        <div class="form-group">
          <label data-i18n="targetPrice">Целевая цена ($)</label>
          <input type="number" id="alertTargetPrice" step="any" min="0" required>
        </div>
        <button type="submit" class="action-btn btn-primary" style="width: 100%;">
          <i class="fas fa-bell"></i> <span data-i18n="createAlertBtn">Создать</span>
        </button>
      </form>
    </div>
  </div>

  <script>
    /**
     * Словарь переводов
     */
    const translations = {
      ru: {
        title: "Крипто Трекер",
        subtitle: "Отслеживайте криптовалюты и управляйте портфелем",
        settings: "Настройки",
        darkTheme: "Темная тема",
        english: "English",
        tabMarket: "Рынок",
        tabPortfolio: "Портфель",
        tabCharts: "Графики",
        tabAlerts: "Уведомления",
        marketCap: "Капитализация",
        volume24h: "Объем 24ч",
        btcDominance: "BTC Доминация",
        activeCryptos: "Активных монет",
        searchPlaceholder: "Поиск криптовалюты...",
        loading: "Загрузка...",
        rank: "#",
        name: "Название",
        price: "Цена",
        change24h: "24ч",
        change7d: "7д",
        marketCapCol: "Капитализация",
        volumeCol: "Объем",
        actions: "Действия",
        addToPortfolio: "Добавить в портфель",
        setAlert: "Установить алерт",
        totalValue: "Общая стоимость",
        totalCost: "Вложено",
        profitLoss: "Прибыль/Убыток",
        pnlPercent: "% изменения",
        myPortfolio: "Мой портфель",
        addAsset: "Добавить",
        emptyPortfolio: "Портфель пуст. Добавьте криптовалюту для отслеживания.",
        priceChart: "График цены",
        priceAlerts: "Ценовые уведомления",
        addAlert: "Добавить",
        emptyAlerts: "Нет активных уведомлений",
        dataSource: "Данные предоставлены",
        selectCoin: "Выберите монету",
        quantity: "Количество",
        buyPrice: "Цена покупки ($)",
        add: "Добавить",
        alertType: "Тип уведомления",
        priceAbove: "Цена выше",
        priceBelow: "Цена ниже",
        targetPrice: "Целевая цена ($)",
        createAlert: "Создать уведомление",
        createAlertBtn: "Создать",
        delete: "Удалить",
        holdings: "Количество",
        avgPrice: "Ср. цена",
        currentPrice: "Текущая цена",
        value: "Стоимость",
        pnl: "P&L",
        alertTriggered: "Уведомление сработало!",
        error: "Ошибка загрузки данных"
      },
      en: {
        title: "Crypto Tracker",
        subtitle: "Track cryptocurrencies and manage your portfolio",
        settings: "Settings",
        darkTheme: "Dark theme",
        english: "English",
        tabMarket: "Market",
        tabPortfolio: "Portfolio",
        tabCharts: "Charts",
        tabAlerts: "Alerts",
        marketCap: "Market Cap",
        volume24h: "24h Volume",
        btcDominance: "BTC Dominance",
        activeCryptos: "Active Cryptos",
        searchPlaceholder: "Search cryptocurrency...",
        loading: "Loading...",
        rank: "#",
        name: "Name",
        price: "Price",
        change24h: "24h",
        change7d: "7d",
        marketCapCol: "Market Cap",
        volumeCol: "Volume",
        actions: "Actions",
        addToPortfolio: "Add to portfolio",
        setAlert: "Set alert",
        totalValue: "Total Value",
        totalCost: "Total Cost",
        profitLoss: "Profit/Loss",
        pnlPercent: "% Change",
        myPortfolio: "My Portfolio",
        addAsset: "Add",
        emptyPortfolio: "Portfolio is empty. Add cryptocurrency to track.",
        priceChart: "Price Chart",
        priceAlerts: "Price Alerts",
        addAlert: "Add",
        emptyAlerts: "No active alerts",
        dataSource: "Data provided by",
        selectCoin: "Select coin",
        quantity: "Quantity",
        buyPrice: "Buy price ($)",
        add: "Add",
        alertType: "Alert type",
        priceAbove: "Price above",
        priceBelow: "Price below",
        targetPrice: "Target price ($)",
        createAlert: "Create Alert",
        createAlertBtn: "Create",
        delete: "Delete",
        holdings: "Holdings",
        avgPrice: "Avg. Price",
        currentPrice: "Current Price",
        value: "Value",
        pnl: "P&L",
        alertTriggered: "Alert triggered!",
        error: "Error loading data"
      }
    };

    /**
     * Состояние приложения
     */
    let state = {
      cryptos: [],
      portfolio: [],
      alerts: [],
      lang: "ru",
      theme: "light",
      chartDays: 7,
      chartCoin: "bitcoin",
      priceChart: null
    };

    /**
     * Загрузка настроек из localStorage
     */
    function loadSettings() {
      const saved = localStorage.getItem("cryptoTrackerSettings");
      if (saved) {
        const settings = JSON.parse(saved);
        state.lang = settings.lang || "ru";
        state.theme = settings.theme || "light";
      }

      const portfolio = localStorage.getItem("cryptoPortfolio");
      if (portfolio) {
        state.portfolio = JSON.parse(portfolio);
      }

      const alerts = localStorage.getItem("cryptoAlerts");
      if (alerts) {
        state.alerts = JSON.parse(alerts);
      }
    }

    /**
     * Сохранение настроек
     */
    function saveSettings() {
      localStorage.setItem("cryptoTrackerSettings", JSON.stringify({
        lang: state.lang,
        theme: state.theme
      }));
    }

    /**
     * Сохранение портфеля
     */
    function savePortfolio() {
      localStorage.setItem("cryptoPortfolio", JSON.stringify(state.portfolio));
    }

    /**
     * Сохранение алертов
     */
    function saveAlerts() {
      localStorage.setItem("cryptoAlerts", JSON.stringify(state.alerts));
    }

    /**
     * Применение темы
     */
    function applyTheme() {
      document.body.setAttribute("data-theme", state.theme);
      document.getElementById("themeSwitch").checked = state.theme === "dark";
    }

    /**
     * Применение языка
     */
    function applyLanguage() {
      const t = translations[state.lang];
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (t[key]) {
          el.textContent = t[key];
        }
      });
      document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
        const key = el.getAttribute("data-i18n-placeholder");
        if (t[key]) {
          el.placeholder = t[key];
        }
      });
      document.getElementById("langSwitch").checked = state.lang === "en";
    }

    /**
     * Форматирование валюты
     * @param {number} value - Значение
     * @returns {string} Отформатированное значение
     */
    function formatCurrency(value) {
      if (value >= 1e12) {
        return "$" + (value / 1e12).toFixed(2) + "T";
      } else if (value >= 1e9) {
        return "$" + (value / 1e9).toFixed(2) + "B";
      } else if (value >= 1e6) {
        return "$" + (value / 1e6).toFixed(2) + "M";
      } else if (value >= 1) {
        return "$" + value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      } else {
        return "$" + value.toFixed(6);
      }
    }

    /**
     * Форматирование процента
     * @param {number} value - Значение
     * @returns {string} Отформатированный процент
     */
    function formatPercent(value) {
      const sign = value >= 0 ? "+" : "";
      return sign + value.toFixed(2) + "%";
    }

    /**
     * Получение данных о криптовалютах
     */
    async function fetchCryptos() {
      const cacheKey = "cryptosData";
      const cached = localStorage.getItem(cacheKey);

      if (cached) {
        const { data, timestamp } = JSON.parse(cached);
        if (Date.now() - timestamp < 60 * 1000) {
          return data;
        }
      }

      const response = await fetch(
        "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=24h,7d"
      );

      if (!response.ok) {
        throw new Error("Failed to fetch");
      }

      const data = await response.json();

      localStorage.setItem(cacheKey, JSON.stringify({
        data,
        timestamp: Date.now()
      }));

      return data;
    }

    /**
     * Получение глобальных данных рынка
     */
    async function fetchGlobalData() {
      const cacheKey = "globalData";
      const cached = localStorage.getItem(cacheKey);

      if (cached) {
        const { data, timestamp } = JSON.parse(cached);
        if (Date.now() - timestamp < 60 * 1000) {
          return data;
        }
      }

      const response = await fetch("https://api.coingecko.com/api/v3/global");

      if (!response.ok) {
        throw new Error("Failed to fetch global data");
      }

      const result = await response.json();

      localStorage.setItem(cacheKey, JSON.stringify({
        data: result.data,
        timestamp: Date.now()
      }));

      return result.data;
    }

    /**
     * Получение исторических данных для графика
     * @param {string} coinId - ID монеты
     * @param {number} days - Количество дней
     */
    async function fetchChartData(coinId, days) {
      const cacheKey = `chart_${coinId}_${days}`;
      const cached = localStorage.getItem(cacheKey);

      if (cached) {
        const { data, timestamp } = JSON.parse(cached);
        if (Date.now() - timestamp < 5 * 60 * 1000) {
          return data;
        }
      }

      const response = await fetch(
        `https://api.coingecko.com/api/v3/coins/${coinId}/market_chart?vs_currency=usd&days=${days}`
      );

      if (!response.ok) {
        throw new Error("Failed to fetch chart data");
      }

      const data = await response.json();

      localStorage.setItem(cacheKey, JSON.stringify({
        data,
        timestamp: Date.now()
      }));

      return data;
    }

    /**
     * Загрузка данных рынка
     */
    async function loadMarketData() {
      const container = document.getElementById("cryptoTableContainer");
      container.innerHTML = `
        <div class="loading">
          <i class="fas fa-spinner"></i>
          <p data-i18n="loading">${translations[state.lang].loading}</p>
        </div>
      `;

      try {
        const [cryptos, global] = await Promise.all([
          fetchCryptos(),
          fetchGlobalData()
        ]);

        state.cryptos = cryptos;

        updateMarketStats(global);
        renderCryptoTable(cryptos);
        updateCoinSelects(cryptos);
        checkAlerts(cryptos);

      } catch (error) {
        console.error("Error:", error);
        container.innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-triangle"></i>
            <p>${translations[state.lang].error}</p>
            <button class="action-btn btn-primary" onclick="loadMarketData()">
              <i class="fas fa-redo"></i> Retry
            </button>
          </div>
        `;
      }
    }

    /**
     * Обновление статистики рынка
     * @param {Object} global - Глобальные данные
     */
    function updateMarketStats(global) {
      document.getElementById("totalMarketCap").textContent =
        formatCurrency(global.total_market_cap.usd);
      document.getElementById("totalVolume").textContent =
        formatCurrency(global.total_volume.usd);
      document.getElementById("btcDominance").textContent =
        global.market_cap_percentage.btc.toFixed(1) + "%";
      document.getElementById("activeCryptos").textContent =
        global.active_cryptocurrencies.toLocaleString();
    }

    /**
     * Отрисовка таблицы криптовалют
     * @param {Array} cryptos - Массив криптовалют
     */
    function renderCryptoTable(cryptos) {
      const t = translations[state.lang];
      const searchTerm = document.getElementById("searchCrypto").value.toLowerCase();

      const filtered = cryptos.filter(c =>
        c.name.toLowerCase().includes(searchTerm) ||
        c.symbol.toLowerCase().includes(searchTerm)
      );

      const html = `
        <table class="crypto-table">
          <thead>
            <tr>
              <th>${t.rank}</th>
              <th>${t.name}</th>
              <th>${t.price}</th>
              <th>${t.change24h}</th>
              <th>${t.change7d}</th>
              <th>${t.marketCapCol}</th>
              <th>${t.volumeCol}</th>
              <th>${t.actions}</th>
            </tr>
          </thead>
          <tbody>
            ${filtered.map(crypto => `
              <tr>
                <td>${crypto.market_cap_rank}</td>
                <td>
                  <div class="crypto-name">
                    <img src="${crypto.image}" alt="${crypto.name}" class="crypto-icon">
                    <div>
                      <div>${crypto.name}</div>
                      <div class="crypto-symbol">${crypto.symbol}</div>
                    </div>
                  </div>
                </td>
                <td>${formatCurrency(crypto.current_price)}</td>
                <td>
                  <span class="price-change ${crypto.price_change_percentage_24h >= 0 ? 'price-up' : 'price-down'}">
                    ${formatPercent(crypto.price_change_percentage_24h || 0)}
                  </span>
                </td>
                <td>
                  <span class="price-change ${(crypto.price_change_percentage_7d_in_currency || 0) >= 0 ? 'price-up' : 'price-down'}">
                    ${formatPercent(crypto.price_change_percentage_7d_in_currency || 0)}
                  </span>
                </td>
                <td>${formatCurrency(crypto.market_cap)}</td>
                <td>${formatCurrency(crypto.total_volume)}</td>
                <td>
                  <button class="action-btn btn-primary" onclick="openAddAssetModal('${crypto.id}', ${crypto.current_price})" title="${t.addToPortfolio}">
                    <i class="fas fa-plus"></i>
                  </button>
                  <button class="action-btn btn-secondary" onclick="openAddAlertModal('${crypto.id}', ${crypto.current_price})" title="${t.setAlert}">
                    <i class="fas fa-bell"></i>
                  </button>
                </td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;

      document.getElementById("cryptoTableContainer").innerHTML = html;
    }

    /**
     * Обновление выпадающих списков монет
     * @param {Array} cryptos - Массив криптовалют
     */
    function updateCoinSelects(cryptos) {
      const options = cryptos.slice(0, 50).map(c =>
        `<option value="${c.id}" data-price="${c.current_price}">${c.name} (${c.symbol.toUpperCase()})</option>`
      ).join("");

      document.getElementById("assetCoinSelect").innerHTML =
        `<option value="">-- ${translations[state.lang].selectCoin} --</option>` + options;
      document.getElementById("alertCoinSelect").innerHTML =
        `<option value="">-- ${translations[state.lang].selectCoin} --</option>` + options;

      const chartSelect = document.getElementById("chartCoinSelect");
      chartSelect.innerHTML = cryptos.slice(0, 20).map(c =>
        `<option value="${c.id}">${c.name} (${c.symbol.toUpperCase()})</option>`
      ).join("");
    }

    /**
     * Открыть модальное окно добавления актива
     * @param {string} coinId - ID монеты
     * @param {number} price - Текущая цена
     */
    function openAddAssetModal(coinId = "", price = 0) {
      document.getElementById("addAssetModal").classList.add("show");
      if (coinId) {
        document.getElementById("assetCoinSelect").value = coinId;
        document.getElementById("assetBuyPrice").value = price;
      }
    }

    /**
     * Открыть модальное окно добавления алерта
     * @param {string} coinId - ID монеты
     * @param {number} price - Текущая цена
     */
    function openAddAlertModal(coinId = "", price = 0) {
      document.getElementById("addAlertModal").classList.add("show");
      if (coinId) {
        document.getElementById("alertCoinSelect").value = coinId;
        document.getElementById("alertTargetPrice").value = price;
      }
    }

    /**
     * Закрыть модальные окна
     */
    function closeModals() {
      document.querySelectorAll(".modal-overlay").forEach(m =>
        m.classList.remove("show")
      );
    }

    /**
     * Добавить актив в портфель
     * @param {Event} e - Событие формы
     */
    function addAsset(e) {
      e.preventDefault();

      const coinId = document.getElementById("assetCoinSelect").value;
      const quantity = parseFloat(document.getElementById("assetQuantity").value);
      const buyPrice = parseFloat(document.getElementById("assetBuyPrice").value);

      if (!coinId || isNaN(quantity) || isNaN(buyPrice)) return;

      const coin = state.cryptos.find(c => c.id === coinId);
      if (!coin) return;

      const existing = state.portfolio.find(p => p.coinId === coinId);
      if (existing) {
        const totalQuantity = existing.quantity + quantity;
        const totalCost = (existing.quantity * existing.avgPrice) + (quantity * buyPrice);
        existing.avgPrice = totalCost / totalQuantity;
        existing.quantity = totalQuantity;
      } else {
        state.portfolio.push({
          coinId,
          name: coin.name,
          symbol: coin.symbol,
          image: coin.image,
          quantity,
          avgPrice: buyPrice
        });
      }

      savePortfolio();
      renderPortfolio();
      closeModals();
      document.getElementById("addAssetForm").reset();
    }

    /**
     * Удалить актив из портфеля
     * @param {string} coinId - ID монеты
     */
    function removeAsset(coinId) {
      state.portfolio = state.portfolio.filter(p => p.coinId !== coinId);
      savePortfolio();
      renderPortfolio();
    }

    /**
     * Отрисовка портфеля
     */
    function renderPortfolio() {
      const t = translations[state.lang];
      const container = document.getElementById("portfolioList");

      if (state.portfolio.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <p>${t.emptyPortfolio}</p>
          </div>
        `;
        updatePortfolioSummary(0, 0);
        return;
      }

      let totalValue = 0;
      let totalCost = 0;

      const html = `
        <div class="crypto-table-container">
          <table class="crypto-table">
            <thead>
              <tr>
                <th>${t.name}</th>
                <th>${t.holdings}</th>
                <th>${t.avgPrice}</th>
                <th>${t.currentPrice}</th>
                <th>${t.value}</th>
                <th>${t.pnl}</th>
                <th>${t.actions}</th>
              </tr>
            </thead>
            <tbody>
              ${state.portfolio.map(asset => {
                const crypto = state.cryptos.find(c => c.id === asset.coinId);
                const currentPrice = crypto ? crypto.current_price : 0;
                const value = asset.quantity * currentPrice;
                const cost = asset.quantity * asset.avgPrice;
                const pnl = value - cost;
                const pnlPercent = cost > 0 ? ((pnl / cost) * 100) : 0;

                totalValue += value;
                totalCost += cost;

                return `
                  <tr>
                    <td>
                      <div class="crypto-name">
                        <img src="${asset.image}" alt="${asset.name}" class="crypto-icon">
                        <div>
                          <div>${asset.name}</div>
                          <div class="crypto-symbol">${asset.symbol}</div>
                        </div>
                      </div>
                    </td>
                    <td>${asset.quantity.toLocaleString()}</td>
                    <td>${formatCurrency(asset.avgPrice)}</td>
                    <td>${formatCurrency(currentPrice)}</td>
                    <td>${formatCurrency(value)}</td>
                    <td>
                      <span class="${pnl >= 0 ? 'profit' : 'loss'}">
                        ${formatCurrency(pnl)} (${formatPercent(pnlPercent)})
                      </span>
                    </td>
                    <td>
                      <button class="action-btn btn-danger" onclick="removeAsset('${asset.coinId}')">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                `;
              }).join("")}
            </tbody>
          </table>
        </div>
      `;

      container.innerHTML = html;
      updatePortfolioSummary(totalValue, totalCost);
    }

    /**
     * Обновление сводки портфеля
     * @param {number} totalValue - Общая стоимость
     * @param {number} totalCost - Общие вложения
     */
    function updatePortfolioSummary(totalValue, totalCost) {
      const pnl = totalValue - totalCost;
      const pnlPercent = totalCost > 0 ? ((pnl / totalCost) * 100) : 0;

      document.getElementById("portfolioValue").textContent = formatCurrency(totalValue);
      document.getElementById("portfolioCost").textContent = formatCurrency(totalCost);

      const pnlEl = document.getElementById("portfolioPnL");
      pnlEl.textContent = formatCurrency(pnl);
      pnlEl.className = "summary-value " + (pnl >= 0 ? "profit" : "loss");

      const pnlPercentEl = document.getElementById("portfolioPnLPercent");
      pnlPercentEl.textContent = formatPercent(pnlPercent);
      pnlPercentEl.className = "summary-value " + (pnlPercent >= 0 ? "profit" : "loss");
    }

    /**
     * Добавить алерт
     * @param {Event} e - Событие формы
     */
    function addAlert(e) {
      e.preventDefault();

      const coinId = document.getElementById("alertCoinSelect").value;
      const type = document.getElementById("alertType").value;
      const targetPrice = parseFloat(document.getElementById("alertTargetPrice").value);

      if (!coinId || isNaN(targetPrice)) return;

      const coin = state.cryptos.find(c => c.id === coinId);
      if (!coin) return;

      state.alerts.push({
        id: Date.now(),
        coinId,
        name: coin.name,
        symbol: coin.symbol,
        type,
        targetPrice,
        active: true
      });

      saveAlerts();
      renderAlerts();
      closeModals();
      document.getElementById("addAlertForm").reset();

      requestNotificationPermission();
    }

    /**
     * Удалить алерт
     * @param {number} id - ID алерта
     */
    function removeAlert(id) {
      state.alerts = state.alerts.filter(a => a.id !== id);
      saveAlerts();
      renderAlerts();
    }

    /**
     * Отрисовка алертов
     */
    function renderAlerts() {
      const t = translations[state.lang];
      const container = document.getElementById("alertsList");

      const activeAlerts = state.alerts.filter(a => a.active);

      if (activeAlerts.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-bell-slash"></i>
            <p>${t.emptyAlerts}</p>
          </div>
        `;
        return;
      }

      container.innerHTML = activeAlerts.map(alert => `
        <div class="alert-item">
          <div class="alert-info">
            <span class="alert-coin">${alert.name} (${alert.symbol.toUpperCase()})</span>
            <span class="alert-type ${alert.type === 'above' ? 'alert-above' : 'alert-below'}">
              ${alert.type === 'above' ? '↑' : '↓'} ${formatCurrency(alert.targetPrice)}
            </span>
          </div>
          <button class="action-btn btn-danger" onclick="removeAlert(${alert.id})">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      `).join("");
    }

    /**
     * Проверка алертов
     * @param {Array} cryptos - Массив криптовалют
     */
    function checkAlerts(cryptos) {
      state.alerts.forEach(alert => {
        if (!alert.active) return;

        const crypto = cryptos.find(c => c.id === alert.coinId);
        if (!crypto) return;

        const triggered = (alert.type === "above" && crypto.current_price >= alert.targetPrice) ||
                          (alert.type === "below" && crypto.current_price <= alert.targetPrice);

        if (triggered) {
          showNotification(alert, crypto.current_price);
          alert.active = false;
          saveAlerts();
          renderAlerts();
        }
      });
    }

    /**
     * Запрос разрешения на уведомления
     */
    function requestNotificationPermission() {
      if ("Notification" in window && Notification.permission === "default") {
        Notification.requestPermission();
      }
    }

    /**
     * Показать уведомление
     * @param {Object} alert - Объект алерта
     * @param {number} currentPrice - Текущая цена
     */
    function showNotification(alert, currentPrice) {
      const t = translations[state.lang];

      if ("Notification" in window && Notification.permission === "granted") {
        new Notification(t.alertTriggered, {
          body: `${alert.name}: ${formatCurrency(currentPrice)}`,
          icon: "https://assets.coingecko.com/coins/images/1/small/bitcoin.png"
        });
      }
    }

    /**
     * Загрузка и отображение графика
     */
    async function loadChart() {
      const coinId = document.getElementById("chartCoinSelect").value;
      const days = state.chartDays;

      try {
        const data = await fetchChartData(coinId, days);
        renderChart(data.prices, coinId);
      } catch (error) {
        console.error("Chart error:", error);
      }
    }

    /**
     * Отрисовка графика
     * @param {Array} prices - Массив цен
     * @param {string} coinId - ID монеты
     */
    function renderChart(prices, coinId) {
      const ctx = document.getElementById("priceChart").getContext("2d");

      if (state.priceChart) {
        state.priceChart.destroy();
      }

      const labels = prices.map(p => {
        const date = new Date(p[0]);
        return date.toLocaleDateString(state.lang === "ru" ? "ru-RU" : "en-US", {
          month: "short",
          day: "numeric"
        });
      });

      const values = prices.map(p => p[1]);
      const isUp = values[values.length - 1] >= values[0];

      state.priceChart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: coinId.charAt(0).toUpperCase() + coinId.slice(1),
            data: values,
            borderColor: isUp ? "#38a169" : "#e53e3e",
            backgroundColor: isUp ? "rgba(56, 161, 105, 0.1)" : "rgba(229, 62, 62, 0.1)",
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 0,
            pointHoverRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            intersect: false,
            mode: "index"
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return formatCurrency(context.raw);
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              },
              ticks: {
                maxTicksLimit: 8,
                color: state.theme === "dark" ? "#a0aec0" : "#718096"
              }
            },
            y: {
              grid: {
                color: state.theme === "dark" ? "#4a5568" : "#e2e8f0"
              },
              ticks: {
                callback: function(value) {
                  return formatCurrency(value);
                },
                color: state.theme === "dark" ? "#a0aec0" : "#718096"
              }
            }
          }
        }
      });
    }

    /**
     * Переключение вкладок
     * @param {string} tabId - ID вкладки
     */
    function switchTab(tabId) {
      document.querySelectorAll(".tab-btn").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.tab === tabId);
      });

      document.querySelectorAll(".tab-content").forEach(content => {
        content.classList.toggle("active", content.id === tabId);
      });

      if (tabId === "charts") {
        loadChart();
      }
    }

    /**
     * Инициализация приложения
     */
    function init() {
      loadSettings();
      applyTheme();
      applyLanguage();

      // Обработчики настроек
      document.getElementById("settingsButton").addEventListener("click", () => {
        document.getElementById("settingsModal").classList.toggle("show");
      });

      document.addEventListener("click", (e) => {
        const modal = document.getElementById("settingsModal");
        const button = document.getElementById("settingsButton");
        if (!modal.contains(e.target) && !button.contains(e.target)) {
          modal.classList.remove("show");
        }
      });

      document.getElementById("themeSwitch").addEventListener("change", (e) => {
        state.theme = e.target.checked ? "dark" : "light";
        applyTheme();
        saveSettings();
        if (state.priceChart) {
          loadChart();
        }
      });

      document.getElementById("langSwitch").addEventListener("change", (e) => {
        state.lang = e.target.checked ? "en" : "ru";
        applyLanguage();
        saveSettings();
        if (state.cryptos.length > 0) {
          renderCryptoTable(state.cryptos);
          renderPortfolio();
          renderAlerts();
        }
      });

      // Обработчики вкладок
      document.querySelectorAll(".tab-btn").forEach(btn => {
        btn.addEventListener("click", () => switchTab(btn.dataset.tab));
      });

      // Обработчики поиска
      document.getElementById("searchCrypto").addEventListener("input", () => {
        if (state.cryptos.length > 0) {
          renderCryptoTable(state.cryptos);
        }
      });

      // Обработчики графика
      document.querySelectorAll(".chart-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".chart-btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          state.chartDays = parseInt(btn.dataset.days);
          loadChart();
        });
      });

      document.getElementById("chartCoinSelect").addEventListener("change", () => {
        state.chartCoin = document.getElementById("chartCoinSelect").value;
        loadChart();
      });

      // Обработчики модальных окон
      document.getElementById("addAssetBtn").addEventListener("click", () => openAddAssetModal());
      document.getElementById("addAlertBtn").addEventListener("click", () => openAddAlertModal());
      document.getElementById("closeAssetModal").addEventListener("click", closeModals);
      document.getElementById("closeAlertModal").addEventListener("click", closeModals);

      document.querySelectorAll(".modal-overlay").forEach(overlay => {
        overlay.addEventListener("click", (e) => {
          if (e.target === overlay) closeModals();
        });
      });

      // Обработчики форм
      document.getElementById("addAssetForm").addEventListener("submit", addAsset);
      document.getElementById("addAlertForm").addEventListener("submit", addAlert);

      // Загрузка данных
      loadMarketData();
      renderPortfolio();
      renderAlerts();

      // Автообновление каждые 60 секунд
      setInterval(() => {
        loadMarketData();
      }, 60000);
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
