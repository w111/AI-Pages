<!DOCTYPE html>
<!--
–¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï

–¶–µ–ª—å: –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫—É –º–∏—Ä–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–æ–Ω–∫–æ–π –¥–∏–∞–≥—Ä–∞–º–º.

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–æ–Ω–∫–∞ —Å—Ç–æ–ª–±—á–∞—Ç—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º (bar chart race):
   - GDP —Å—Ç—Ä–∞–Ω
   - –ù–∞—Å–µ–ª–µ–Ω–∏–µ
   - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏

2. –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ 1960-2024:
   - –ü–æ–ª–∑—É–Ω–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥–æ–¥–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é

3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω:
   - –í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
   - –ì—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
   - –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

4. –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: World Bank API (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)

5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
   - –¢–µ–º–Ω–∞—è –∏ —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
   - –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å (—Ä—É—Å—Å–∫–∏–π/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. Canvas API –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –¥–∏–∞–≥—Ä–∞–º–º
2. Vanilla JavaScript –±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤
3. CSS –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã
4. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
-->
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–∏—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ | World Data Infographic</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg-color: #0f0f23;
      --text-color: #e0e0e0;
      --card-bg: #1a1a2e;
      --border-color: #2a2a4a;
      --primary-color: #00d4ff;
      --primary-hover: #00a8cc;
      --secondary-color: #8892b0;
      --input-bg: #16213e;
      --input-border: #2a2a4a;
      --accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gdp-color: #4ade80;
      --population-color: #f472b6;
      --life-color: #60a5fa;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.4);
      --glow: 0 0 20px rgba(0, 212, 255, 0.3);
    }

    [data-theme="light"] {
      --bg-color: #f5f7fa;
      --text-color: #1a202c;
      --card-bg: #ffffff;
      --border-color: #e2e8f0;
      --primary-color: #3182ce;
      --primary-hover: #2c5282;
      --secondary-color: #718096;
      --input-bg: #ffffff;
      --input-border: #cbd5e0;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --glow: none;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      transition: background-color 0.3s ease, color 0.3s ease;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    header {
      text-align: center;
      margin-bottom: 20px;
      padding: 20px 0;
      position: relative;
    }

    h1 {
      font-size: clamp(1.8rem, 5vw, 3rem);
      font-weight: 700;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }

    .subtitle {
      color: var(--secondary-color);
      font-size: clamp(1rem, 2.5vw, 1.2rem);
    }

    /* Year display */
    .year-display {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: clamp(3rem, 10vw, 6rem);
      font-weight: 900;
      color: var(--primary-color);
      opacity: 0.3;
      font-family: 'Courier New', monospace;
      text-shadow: var(--glow);
    }

    /* Settings button */
    .settings-button {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--card-bg);
      border: 2px solid var(--border-color);
      color: var(--primary-color);
      font-size: 22px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .settings-button:hover {
      transform: rotate(45deg);
      box-shadow: var(--glow);
    }

    /* Settings modal */
    .settings-modal {
      display: none;
      position: fixed;
      top: 80px;
      right: 20px;
      background-color: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow-lg);
      z-index: 1001;
      min-width: 280px;
    }

    .settings-modal.active {
      display: block;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .settings-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--primary-color);
    }

    .settings-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .settings-option label {
      color: var(--text-color);
      font-size: 0.95rem;
    }

    /* Toggle switch */
    .toggle-switch {
      position: relative;
      width: 52px;
      height: 28px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--input-border);
      transition: 0.3s;
      border-radius: 28px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background: var(--accent-gradient);
    }

    input:checked + .slider:before {
      transform: translateX(24px);
    }

    /* Controls */
    .controls-container {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      justify-content: center;
    }

    .metric-buttons {
      display: flex;
      gap: 8px;
      background: var(--input-bg);
      padding: 6px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }

    .metric-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: transparent;
      color: var(--secondary-color);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .metric-btn.active {
      background: var(--accent-gradient);
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .metric-btn:hover:not(.active) {
      color: var(--primary-color);
      background: var(--border-color);
    }

    .metric-btn .indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .metric-btn[data-metric="gdp"] .indicator { background: var(--gdp-color); }
    .metric-btn[data-metric="population"] .indicator { background: var(--population-color); }
    .metric-btn[data-metric="lifeExpectancy"] .indicator { background: var(--life-color); }

    .playback-controls {
      display: flex;
      gap: 8px;
    }

    .control-btn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      color: var(--text-color);
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .control-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
      box-shadow: var(--glow);
    }

    .control-btn.active {
      background: var(--accent-gradient);
      border-color: transparent;
      color: white;
    }

    .speed-control {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--input-bg);
      padding: 8px 16px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }

    .speed-control label {
      color: var(--secondary-color);
      font-size: 0.9rem;
    }

    .speed-slider {
      width: 100px;
      accent-color: var(--primary-color);
    }

    /* Timeline */
    .timeline-container {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
    }

    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .timeline-year {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .timeline-range {
      color: var(--secondary-color);
      font-size: 0.9rem;
    }

    .timeline-slider {
      width: 100%;
      height: 8px;
      accent-color: var(--primary-color);
      cursor: pointer;
    }

    .timeline-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      color: var(--secondary-color);
      font-size: 0.85rem;
    }

    /* Main chart */
    .chart-container {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
      min-height: 500px;
      position: relative;
    }

    .chart-title {
      text-align: center;
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--text-color);
    }

    #raceChart {
      width: 100%;
      height: 450px;
    }

    /* Bar styles */
    .bar-container {
      position: relative;
      height: 450px;
      overflow: hidden;
    }

    .bar-item {
      position: absolute;
      display: flex;
      align-items: center;
      height: 35px;
      transition: all 0.5s ease-out;
      width: 100%;
    }

    .bar-rank {
      width: 30px;
      text-align: center;
      font-weight: 600;
      color: var(--secondary-color);
      font-size: 0.9rem;
    }

    .bar-flag {
      width: 32px;
      height: 22px;
      margin-right: 10px;
      border-radius: 3px;
      object-fit: cover;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .bar-name {
      width: 120px;
      font-size: 0.9rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .bar-wrapper {
      flex: 1;
      height: 28px;
      background: var(--input-bg);
      border-radius: 6px;
      overflow: hidden;
      margin: 0 10px;
    }

    .bar {
      height: 100%;
      border-radius: 6px;
      transition: width 0.5s ease-out;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 10px;
    }

    .bar.gdp { background: linear-gradient(90deg, var(--gdp-color) 0%, #22c55e 100%); }
    .bar.population { background: linear-gradient(90deg, var(--population-color) 0%, #ec4899 100%); }
    .bar.lifeExpectancy { background: linear-gradient(90deg, var(--life-color) 0%, #3b82f6 100%); }

    .bar-value {
      font-size: 0.85rem;
      font-weight: 600;
      color: white;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      white-space: nowrap;
    }

    /* Country comparison */
    .comparison-container {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
    }

    .comparison-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .comparison-title {
      font-size: 1.3rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .country-selector {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .country-select {
      padding: 10px 16px;
      border-radius: 10px;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      color: var(--text-color);
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .country-select:hover, .country-select:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    /* Comparison chart */
    .comparison-chart {
      height: 300px;
      position: relative;
    }

    #comparisonCanvas {
      width: 100%;
      height: 100%;
    }

    /* Stats grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .stat-card {
      background: var(--input-bg);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--glow);
    }

    .stat-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: white;
    }

    .stat-icon.gdp { background: var(--gdp-color); }
    .stat-icon.population { background: var(--population-color); }
    .stat-icon.life { background: var(--life-color); }

    .stat-label {
      font-size: 0.9rem;
      color: var(--secondary-color);
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-color);
    }

    .stat-change {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-top: 8px;
      font-size: 0.85rem;
    }

    .stat-change.positive { color: var(--gdp-color); }
    .stat-change.negative { color: #ef4444; }

    /* Loading */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px;
      color: var(--secondary-color);
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid var(--border-color);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Error message */
    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      color: #ef4444;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      color: var(--secondary-color);
      font-size: 0.9rem;
      border-top: 1px solid var(--border-color);
      margin-top: 20px;
    }

    footer a {
      color: var(--primary-color);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 12px;
      }

      .year-display {
        position: relative;
        right: auto;
        top: auto;
        transform: none;
        text-align: center;
        font-size: 3rem;
      }

      .controls-row {
        flex-direction: column;
      }

      .metric-buttons {
        flex-wrap: wrap;
        justify-content: center;
      }

      .bar-name {
        width: 80px;
        font-size: 0.8rem;
      }

      .bar-flag {
        width: 24px;
        height: 16px;
      }

      .comparison-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <button class="settings-button" id="settingsBtn">
    <i class="fas fa-cog"></i>
  </button>

  <div class="settings-modal" id="settingsModal">
    <div class="settings-title" data-i18n="settings.title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    <div class="settings-option">
      <label data-i18n="settings.darkTheme">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</label>
      <div class="toggle-switch">
        <input type="checkbox" id="themeToggle" checked>
        <span class="slider"></span>
      </div>
    </div>
    <div class="settings-option">
      <label data-i18n="settings.language">–Ø–∑—ã–∫ / Language</label>
      <div class="toggle-switch">
        <input type="checkbox" id="langToggle">
        <span class="slider"></span>
      </div>
    </div>
  </div>

  <div class="container">
    <header>
      <h1 data-i18n="title">–ú–∏—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h1>
      <p class="subtitle" data-i18n="subtitle">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞: GDP, –Ω–∞—Å–µ–ª–µ–Ω–∏–µ, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏</p>
      <div class="year-display" id="yearDisplay">1960</div>
    </header>

    <!-- Controls -->
    <div class="controls-container">
      <div class="controls-row">
        <div class="metric-buttons">
          <button class="metric-btn active" data-metric="gdp">
            <span class="indicator"></span>
            <span data-i18n="metrics.gdp">–í–í–ü</span>
          </button>
          <button class="metric-btn" data-metric="population">
            <span class="indicator"></span>
            <span data-i18n="metrics.population">–ù–∞—Å–µ–ª–µ–Ω–∏–µ</span>
          </button>
          <button class="metric-btn" data-metric="lifeExpectancy">
            <span class="indicator"></span>
            <span data-i18n="metrics.lifeExpectancy">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏</span>
          </button>
        </div>

        <div class="playback-controls">
          <button class="control-btn" id="restartBtn" title="Restart">
            <i class="fas fa-undo"></i>
          </button>
          <button class="control-btn active" id="playPauseBtn" title="Play/Pause">
            <i class="fas fa-pause"></i>
          </button>
        </div>

        <div class="speed-control">
          <label data-i18n="controls.speed">–°–∫–æ—Ä–æ—Å—Ç—å:</label>
          <input type="range" class="speed-slider" id="speedSlider" min="0.5" max="3" step="0.5" value="1">
          <span id="speedValue">1x</span>
        </div>
      </div>
    </div>

    <!-- Timeline -->
    <div class="timeline-container">
      <div class="timeline-header">
        <div>
          <span class="timeline-year" id="currentYear">1960</span>
          <span class="timeline-range" data-i18n="timeline.range">(1960 - 2023)</span>
        </div>
      </div>
      <input type="range" class="timeline-slider" id="timelineSlider" min="1960" max="2023" value="1960">
      <div class="timeline-labels">
        <span>1960</span>
        <span>1980</span>
        <span>2000</span>
        <span>2023</span>
      </div>
    </div>

    <!-- Main Chart -->
    <div class="chart-container">
      <h3 class="chart-title" id="chartTitle" data-i18n="chart.gdpTitle">–í–í–ü —Å—Ç—Ä–∞–Ω –º–∏—Ä–∞ (–º–ª—Ä–¥ USD)</h3>
      <div class="bar-container" id="barContainer">
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <span data-i18n="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
        </div>
      </div>
    </div>

    <!-- Country Comparison -->
    <div class="comparison-container">
      <div class="comparison-header">
        <h3 class="comparison-title">
          <i class="fas fa-chart-line"></i>
          <span data-i18n="comparison.title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω</span>
        </h3>
        <div class="country-selector">
          <select class="country-select" id="country1">
            <option value="USA">–°–®–ê</option>
            <option value="CHN">–ö–∏—Ç–∞–π</option>
            <option value="JPN">–Ø–ø–æ–Ω–∏—è</option>
            <option value="DEU">–ì–µ—Ä–º–∞–Ω–∏—è</option>
            <option value="GBR">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è</option>
            <option value="IND">–ò–Ω–¥–∏—è</option>
            <option value="FRA">–§—Ä–∞–Ω—Ü–∏—è</option>
            <option value="RUS">–†–æ—Å—Å–∏—è</option>
            <option value="BRA">–ë—Ä–∞–∑–∏–ª–∏—è</option>
          </select>
          <span style="color: var(--secondary-color)">vs</span>
          <select class="country-select" id="country2">
            <option value="CHN">–ö–∏—Ç–∞–π</option>
            <option value="USA">–°–®–ê</option>
            <option value="JPN">–Ø–ø–æ–Ω–∏—è</option>
            <option value="DEU">–ì–µ—Ä–º–∞–Ω–∏—è</option>
            <option value="GBR">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è</option>
            <option value="IND">–ò–Ω–¥–∏—è</option>
            <option value="FRA">–§—Ä–∞–Ω—Ü–∏—è</option>
            <option value="RUS">–†–æ—Å—Å–∏—è</option>
            <option value="BRA">–ë—Ä–∞–∑–∏–ª–∏—è</option>
          </select>
        </div>
      </div>

      <div class="comparison-chart">
        <canvas id="comparisonCanvas"></canvas>
      </div>

      <div class="stats-grid" id="statsGrid">
        <!-- Stats will be dynamically generated -->
      </div>
    </div>

    <footer>
      <p data-i18n="footer.source">–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: <a href="https://data.worldbank.org/" target="_blank">World Bank Open Data</a></p>
      <p data-i18n="footer.copyright">¬© 2025 AI Pages</p>
    </footer>
  </div>

  <script>
    /**
     * @description –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞ –º–∏—Ä–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
     * @description World Data Infographic - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö World Bank
     */

    // –ü–µ—Ä–µ–≤–æ–¥—ã
    const translations = {
      ru: {
        title: "–ú–∏—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ",
        subtitle: "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞: GDP, –Ω–∞—Å–µ–ª–µ–Ω–∏–µ, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏",
        settings: {
          title: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
          darkTheme: "–¢–µ–º–Ω–∞—è —Ç–µ–º–∞",
          language: "English"
        },
        metrics: {
          gdp: "–í–í–ü",
          population: "–ù–∞—Å–µ–ª–µ–Ω–∏–µ",
          lifeExpectancy: "–ü—Ä–æ–¥. –∂–∏–∑–Ω–∏"
        },
        controls: {
          speed: "–°–∫–æ—Ä–æ—Å—Ç—å:"
        },
        timeline: {
          range: "(1960 - 2023)"
        },
        chart: {
          gdpTitle: "–í–í–ü —Å—Ç—Ä–∞–Ω –º–∏—Ä–∞ (–º–ª—Ä–¥ USD)",
          populationTitle: "–ù–∞—Å–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω –º–∏—Ä–∞ (–º–ª–Ω —á–µ–ª.)",
          lifeExpectancyTitle: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏ (–ª–µ—Ç)"
        },
        comparison: {
          title: "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω",
          gdp: "–í–í–ü",
          population: "–ù–∞—Å–µ–ª–µ–Ω–∏–µ",
          lifeExpectancy: "–ü—Ä–æ–¥. –∂–∏–∑–Ω–∏",
          change: "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å 1960"
        },
        loading: "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",
        error: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.",
        footer: {
          source: "–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:",
          copyright: "¬© 2025 AI Pages"
        },
        countries: {
          USA: "–°–®–ê", CHN: "–ö–∏—Ç–∞–π", JPN: "–Ø–ø–æ–Ω–∏—è", DEU: "–ì–µ—Ä–º–∞–Ω–∏—è",
          GBR: "–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è", IND: "–ò–Ω–¥–∏—è", FRA: "–§—Ä–∞–Ω—Ü–∏—è",
          RUS: "–†–æ—Å—Å–∏—è", BRA: "–ë—Ä–∞–∑–∏–ª–∏—è", ITA: "–ò—Ç–∞–ª–∏—è", CAN: "–ö–∞–Ω–∞–¥–∞",
          KOR: "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è", AUS: "–ê–≤—Å—Ç—Ä–∞–ª–∏—è", ESP: "–ò—Å–ø–∞–Ω–∏—è", MEX: "–ú–µ–∫—Å–∏–∫–∞",
          IDN: "–ò–Ω–¥–æ–Ω–µ–∑–∏—è", NLD: "–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã", SAU: "–°–∞—É–¥–æ–≤—Å–∫–∞—è –ê—Ä–∞–≤–∏—è",
          TUR: "–¢—É—Ä—Ü–∏—è", CHE: "–®–≤–µ–π—Ü–∞—Ä–∏—è"
        }
      },
      en: {
        title: "World Data",
        subtitle: "Interactive infographic: GDP, population, life expectancy",
        settings: {
          title: "Settings",
          darkTheme: "Dark theme",
          language: "–†—É—Å—Å–∫–∏–π"
        },
        metrics: {
          gdp: "GDP",
          population: "Population",
          lifeExpectancy: "Life Expectancy"
        },
        controls: {
          speed: "Speed:"
        },
        timeline: {
          range: "(1960 - 2023)"
        },
        chart: {
          gdpTitle: "World GDP by Country (Billion USD)",
          populationTitle: "World Population by Country (Million)",
          lifeExpectancyTitle: "Life Expectancy (Years)"
        },
        comparison: {
          title: "Country Comparison",
          gdp: "GDP",
          population: "Population",
          lifeExpectancy: "Life Expectancy",
          change: "Change since 1960"
        },
        loading: "Loading data...",
        error: "Error loading data. Please refresh the page.",
        footer: {
          source: "Data source:",
          copyright: "¬© 2025 AI Pages"
        },
        countries: {
          USA: "USA", CHN: "China", JPN: "Japan", DEU: "Germany",
          GBR: "United Kingdom", IND: "India", FRA: "France",
          RUS: "Russia", BRA: "Brazil", ITA: "Italy", CAN: "Canada",
          KOR: "South Korea", AUS: "Australia", ESP: "Spain", MEX: "Mexico",
          IDN: "Indonesia", NLD: "Netherlands", SAU: "Saudi Arabia",
          TUR: "Turkey", CHE: "Switzerland"
        }
      }
    };

    // –î–∞–Ω–Ω—ã–µ –æ —Å—Ç—Ä–∞–Ω–∞—Ö —Å —Ñ–ª–∞–≥–∞–º–∏
    const countryData = {
      USA: { flag: "üá∫üá∏", code: "US" },
      CHN: { flag: "üá®üá≥", code: "CN" },
      JPN: { flag: "üáØüáµ", code: "JP" },
      DEU: { flag: "üá©üá™", code: "DE" },
      GBR: { flag: "üá¨üáß", code: "GB" },
      IND: { flag: "üáÆüá≥", code: "IN" },
      FRA: { flag: "üá´üá∑", code: "FR" },
      RUS: { flag: "üá∑üá∫", code: "RU" },
      BRA: { flag: "üáßüá∑", code: "BR" },
      ITA: { flag: "üáÆüáπ", code: "IT" },
      CAN: { flag: "üá®üá¶", code: "CA" },
      KOR: { flag: "üá∞üá∑", code: "KR" },
      AUS: { flag: "üá¶üá∫", code: "AU" },
      ESP: { flag: "üá™üá∏", code: "ES" },
      MEX: { flag: "üá≤üáΩ", code: "MX" },
      IDN: { flag: "üáÆüá©", code: "ID" },
      NLD: { flag: "üá≥üá±", code: "NL" },
      SAU: { flag: "üá∏üá¶", code: "SA" },
      TUR: { flag: "üáπüá∑", code: "TR" },
      CHE: { flag: "üá®üá≠", code: "CH" }
    };

    // World Bank API –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    const indicators = {
      gdp: "NY.GDP.MKTP.CD",           // GDP (current US$)
      population: "SP.POP.TOTL",        // Population, total
      lifeExpectancy: "SP.DYN.LE00.IN"  // Life expectancy at birth
    };

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    let state = {
      currentMetric: "gdp",
      currentYear: 1960,
      isPlaying: true,
      speed: 1,
      locale: "ru",
      data: {},
      animationFrame: null,
      lastUpdate: 0
    };

    // –ö—ç—à –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
    const dataCache = {};

    /**
     * @function formatNumber
     * @description –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
     * @param {number} num - –ß–∏—Å–ª–æ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
     * @param {string} metric - –¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏
     * @returns {string} –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ
     */
    function formatNumber(num, metric) {
      if (!num && num !== 0) return "‚Äî";

      if (metric === "gdp") {
        // –í –º–∏–ª–ª–∏–∞—Ä–¥–∞—Ö
        const billions = num / 1e9;
        if (billions >= 1000) {
          return (billions / 1000).toFixed(1) + " —Ç—Ä–ª–Ω";
        }
        return billions.toFixed(0) + " –º–ª—Ä–¥";
      } else if (metric === "population") {
        // –í –º–∏–ª–ª–∏–æ–Ω–∞—Ö
        const millions = num / 1e6;
        if (millions >= 1000) {
          return (millions / 1000).toFixed(2) + " –º–ª—Ä–¥";
        }
        return millions.toFixed(1) + " –º–ª–Ω";
      } else {
        // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏
        return num.toFixed(1) + " –ª–µ—Ç";
      }
    }

    /**
     * @function fetchWorldBankData
     * @description –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ World Bank API
     * @param {string} indicator - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä API
     * @param {string[]} countries - –°–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤ —Å—Ç—Ä–∞–Ω
     * @returns {Promise<Object>} –î–∞–Ω–Ω—ã–µ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º
     */
    async function fetchWorldBankData(indicator, countries) {
      const cacheKey = `${indicator}_${countries.join(",")}`;
      if (dataCache[cacheKey]) {
        return dataCache[cacheKey];
      }

      const countryCodes = countries.join(";");
      const url = `https://api.worldbank.org/v2/country/${countryCodes}/indicator/${indicator}?format=json&per_page=5000&date=1960:2023`;

      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("API Error");

        const data = await response.json();
        if (!data[1]) throw new Error("No data");

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —É–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
        const result = {};
        data[1].forEach(item => {
          const countryCode = item.countryiso3code;
          const year = parseInt(item.date);
          const value = item.value;

          if (!result[countryCode]) {
            result[countryCode] = {};
          }
          result[countryCode][year] = value;
        });

        dataCache[cacheKey] = result;
        return result;
      } catch (error) {
        console.error("Error fetching data:", error);
        throw error;
      }
    }

    /**
     * @function loadAllData
     * @description –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ API
     */
    async function loadAllData() {
      const countries = Object.keys(countryData);
      const loading = document.getElementById("loading");

      try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
        const [gdpData, populationData, lifeData] = await Promise.all([
          fetchWorldBankData(indicators.gdp, countries),
          fetchWorldBankData(indicators.population, countries),
          fetchWorldBankData(indicators.lifeExpectancy, countries)
        ]);

        state.data = {
          gdp: gdpData,
          population: populationData,
          lifeExpectancy: lifeData
        };

        loading.style.display = "none";
        renderBars();
        renderComparison();
        startAnimation();

      } catch (error) {
        loading.innerHTML = `
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            <p data-i18n="error">${translations[state.locale].error}</p>
          </div>
        `;
      }
    }

    /**
     * @function getDataForYear
     * @description –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≥–æ–¥
     * @param {string} metric - –ú–µ—Ç—Ä–∏–∫–∞
     * @param {number} year - –ì–æ–¥
     * @returns {Array} –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö
     */
    function getDataForYear(metric, year) {
      const data = state.data[metric];
      if (!data) return [];

      const result = [];
      Object.keys(countryData).forEach(code => {
        if (data[code] && data[code][year]) {
          result.push({
            code,
            value: data[code][year],
            flag: countryData[code].flag,
            name: translations[state.locale].countries[code] || code
          });
        }
      });

      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
      return result.sort((a, b) => b.value - a.value).slice(0, 12);
    }

    /**
     * @function renderBars
     * @description –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ç–æ–ª–±—á–∞—Ç–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
     */
    function renderBars() {
      const container = document.getElementById("barContainer");
      const data = getDataForYear(state.currentMetric, state.currentYear);

      if (data.length === 0) {
        container.innerHTML = '<div class="loading"><span>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —ç—Ç–æ—Ç –≥–æ–¥</span></div>';
        return;
      }

      const maxValue = data[0].value;
      const barHeight = 38;

      container.innerHTML = data.map((item, index) => `
        <div class="bar-item" style="top: ${index * barHeight}px">
          <span class="bar-rank">${index + 1}</span>
          <span class="bar-flag">${item.flag}</span>
          <span class="bar-name">${item.name}</span>
          <div class="bar-wrapper">
            <div class="bar ${state.currentMetric}" style="width: ${(item.value / maxValue) * 100}%">
              <span class="bar-value">${formatNumber(item.value, state.currentMetric)}</span>
            </div>
          </div>
        </div>
      `).join("");

      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
      const titleKey = `chart.${state.currentMetric}Title`;
      document.getElementById("chartTitle").textContent =
        translations[state.locale].chart[`${state.currentMetric}Title`];
    }

    /**
     * @function renderComparison
     * @description –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω
     */
    function renderComparison() {
      const canvas = document.getElementById("comparisonCanvas");
      const ctx = canvas.getContext("2d");

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width * window.devicePixelRatio;
      canvas.height = rect.height * window.devicePixelRatio;
      ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

      const width = rect.width;
      const height = rect.height;

      const country1 = document.getElementById("country1").value;
      const country2 = document.getElementById("country2").value;

      const data1 = state.data[state.currentMetric]?.[country1] || {};
      const data2 = state.data[state.currentMetric]?.[country2] || {};

      // –û—á–∏—Å—Ç–∫–∞
      ctx.clearRect(0, 0, width, height);

      // –¶–≤–µ—Ç–∞ –¥–ª—è —Å—Ç—Ä–∞–Ω
      const color1 = "#4ade80";
      const color2 = "#f472b6";

      // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
      const years = [];
      const values1 = [];
      const values2 = [];

      for (let year = 1960; year <= 2023; year++) {
        if (data1[year] || data2[year]) {
          years.push(year);
          values1.push(data1[year] || 0);
          values2.push(data2[year] || 0);
        }
      }

      if (years.length === 0) return;

      const maxValue = Math.max(...values1, ...values2);
      const padding = { top: 20, right: 20, bottom: 40, left: 60 };
      const chartWidth = width - padding.left - padding.right;
      const chartHeight = height - padding.top - padding.bottom;

      // –†–∏—Å—É–µ–º –æ—Å–∏
      ctx.strokeStyle = getComputedStyle(document.documentElement)
        .getPropertyValue('--border-color').trim();
      ctx.lineWidth = 1;

      // –û—Å—å X
      ctx.beginPath();
      ctx.moveTo(padding.left, height - padding.bottom);
      ctx.lineTo(width - padding.right, height - padding.bottom);
      ctx.stroke();

      // –û—Å—å Y
      ctx.beginPath();
      ctx.moveTo(padding.left, padding.top);
      ctx.lineTo(padding.left, height - padding.bottom);
      ctx.stroke();

      // –ú–µ—Ç–∫–∏ –æ—Å–∏ X
      ctx.fillStyle = getComputedStyle(document.documentElement)
        .getPropertyValue('--secondary-color').trim();
      ctx.font = "12px sans-serif";
      ctx.textAlign = "center";

      [1960, 1980, 2000, 2023].forEach(year => {
        const idx = years.indexOf(year);
        if (idx >= 0) {
          const x = padding.left + (idx / (years.length - 1)) * chartWidth;
          ctx.fillText(year, x, height - padding.bottom + 20);
        }
      });

      /**
       * @function drawLine
       * @description –†–∏—Å—É–µ—Ç –ª–∏–Ω–∏—é –≥—Ä–∞—Ñ–∏–∫–∞
       */
      function drawLine(values, color) {
        ctx.beginPath();
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;

        values.forEach((value, i) => {
          const x = padding.left + (i / (values.length - 1)) * chartWidth;
          const y = height - padding.bottom - (value / maxValue) * chartHeight;

          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });

        ctx.stroke();
      }

      drawLine(values1, color1);
      drawLine(values2, color2);

      // –õ–µ–≥–µ–Ω–¥–∞
      const legendY = 15;
      ctx.font = "13px sans-serif";

      ctx.fillStyle = color1;
      ctx.fillRect(padding.left, legendY - 8, 16, 16);
      ctx.fillStyle = getComputedStyle(document.documentElement)
        .getPropertyValue('--text-color').trim();
      ctx.textAlign = "left";
      ctx.fillText(translations[state.locale].countries[country1], padding.left + 22, legendY + 4);

      ctx.fillStyle = color2;
      ctx.fillRect(padding.left + 120, legendY - 8, 16, 16);
      ctx.fillStyle = getComputedStyle(document.documentElement)
        .getPropertyValue('--text-color').trim();
      ctx.fillText(translations[state.locale].countries[country2], padding.left + 142, legendY + 4);

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      updateStats(country1, country2);
    }

    /**
     * @function updateStats
     * @description –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
     */
    function updateStats(country1, country2) {
      const grid = document.getElementById("statsGrid");
      const t = translations[state.locale];

      const metrics = ["gdp", "population", "lifeExpectancy"];
      const icons = { gdp: "fa-dollar-sign", population: "fa-users", life: "fa-heart" };
      const colors = { gdp: "gdp", population: "population", lifeExpectancy: "life" };

      let html = "";

      [country1, country2].forEach(country => {
        metrics.forEach(metric => {
          const data = state.data[metric]?.[country] || {};
          const currentValue = data[state.currentYear] || 0;
          const startValue = data[1960] || currentValue;
          const change = startValue > 0
            ? ((currentValue - startValue) / startValue * 100).toFixed(1)
            : 0;

          const metricLabel = t.comparison[metric] || t.metrics[metric];
          const iconClass = metric === "lifeExpectancy" ? "fa-heart" : icons[metric];

          html += `
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon ${colors[metric]}">
                  <i class="fas ${iconClass}"></i>
                </div>
                <div>
                  <div class="stat-label">${t.countries[country]} - ${metricLabel}</div>
                </div>
              </div>
              <div class="stat-value">${formatNumber(currentValue, metric)}</div>
              <div class="stat-change ${change >= 0 ? 'positive' : 'negative'}">
                <i class="fas fa-arrow-${change >= 0 ? 'up' : 'down'}"></i>
                ${Math.abs(change)}% ${t.comparison.change}
              </div>
            </div>
          `;
        });
      });

      grid.innerHTML = html;
    }

    /**
     * @function startAnimation
     * @description –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª—ã
     */
    function startAnimation() {
      if (state.animationFrame) {
        cancelAnimationFrame(state.animationFrame);
      }

      function animate(timestamp) {
        if (!state.isPlaying) {
          state.animationFrame = requestAnimationFrame(animate);
          return;
        }

        const interval = 1000 / state.speed;

        if (timestamp - state.lastUpdate >= interval) {
          state.lastUpdate = timestamp;

          if (state.currentYear < 2023) {
            state.currentYear++;
            updateYear();
          } else {
            state.currentYear = 1960;
            updateYear();
          }
        }

        state.animationFrame = requestAnimationFrame(animate);
      }

      state.animationFrame = requestAnimationFrame(animate);
    }

    /**
     * @function updateYear
     * @description –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–æ–¥–∞
     */
    function updateYear() {
      document.getElementById("yearDisplay").textContent = state.currentYear;
      document.getElementById("currentYear").textContent = state.currentYear;
      document.getElementById("timelineSlider").value = state.currentYear;
      renderBars();
      renderComparison();
    }

    /**
     * @function updateLanguage
     * @description –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
     */
    function updateLanguage() {
      const t = translations[state.locale];
      document.documentElement.lang = state.locale;

      // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-i18n
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        const keys = key.split(".");
        let value = t;
        keys.forEach(k => value = value?.[k]);
        if (value) el.textContent = value;
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç—ã —Å—Ç—Ä–∞–Ω
      ["country1", "country2"].forEach(id => {
        const select = document.getElementById(id);
        const currentValue = select.value;
        select.innerHTML = Object.keys(countryData).map(code =>
          `<option value="${code}">${t.countries[code]}</option>`
        ).join("");
        select.value = currentValue;
      });

      renderBars();
      renderComparison();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener("DOMContentLoaded", () => {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      const savedTheme = localStorage.getItem("theme");
      const savedLang = localStorage.getItem("language");

      if (savedTheme === "light") {
        document.body.setAttribute("data-theme", "light");
        document.getElementById("themeToggle").checked = false;
      }

      if (savedLang === "en") {
        state.locale = "en";
        document.getElementById("langToggle").checked = true;
        updateLanguage();
      }

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
      document.getElementById("settingsBtn").addEventListener("click", () => {
        document.getElementById("settingsModal").classList.toggle("active");
      });

      document.getElementById("themeToggle").addEventListener("change", (e) => {
        const theme = e.target.checked ? "dark" : "light";
        document.body.setAttribute("data-theme", e.target.checked ? "" : "light");
        localStorage.setItem("theme", theme);
        renderComparison();
      });

      document.getElementById("langToggle").addEventListener("change", (e) => {
        state.locale = e.target.checked ? "en" : "ru";
        localStorage.setItem("language", state.locale);
        updateLanguage();
      });

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
      document.addEventListener("click", (e) => {
        const modal = document.getElementById("settingsModal");
        const btn = document.getElementById("settingsBtn");
        if (!modal.contains(e.target) && !btn.contains(e.target)) {
          modal.classList.remove("active");
        }
      });

      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∞–º–∏
      document.querySelectorAll(".metric-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".metric-btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          state.currentMetric = btn.dataset.metric;
          renderBars();
          renderComparison();
        });
      });

      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
      document.getElementById("playPauseBtn").addEventListener("click", function() {
        state.isPlaying = !state.isPlaying;
        this.classList.toggle("active", state.isPlaying);
        this.innerHTML = state.isPlaying
          ? '<i class="fas fa-pause"></i>'
          : '<i class="fas fa-play"></i>';
      });

      document.getElementById("restartBtn").addEventListener("click", () => {
        state.currentYear = 1960;
        updateYear();
      });

      // –°–∫–æ—Ä–æ—Å—Ç—å
      document.getElementById("speedSlider").addEventListener("input", (e) => {
        state.speed = parseFloat(e.target.value);
        document.getElementById("speedValue").textContent = state.speed + "x";
      });

      // –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞
      document.getElementById("timelineSlider").addEventListener("input", (e) => {
        state.currentYear = parseInt(e.target.value);
        updateYear();
      });

      // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω
      document.getElementById("country1").addEventListener("change", renderComparison);
      document.getElementById("country2").addEventListener("change", renderComparison);

      // Resize handler
      window.addEventListener("resize", () => {
        renderComparison();
      });

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
      loadAllData();
    });
  </script>
</body>
</html>
