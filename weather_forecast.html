<!doctype html>
<!--
–¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï

–¶–µ–ª—å: –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–∏—Ö —É—Å–ª–æ–≤–∏–π –∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ –Ω–∞ 7 –¥–Ω–µ–π.

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞:
   - –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (—Ç–µ–∫—É—â–∞—è, –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫)
   - –í–ª–∞–∂–Ω–æ—Å—Ç—å –∏ —Ç–æ—á–∫–∞ —Ä–æ—Å—ã
   - –°–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞
   - –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ
   - –û–±–ª–∞—á–Ω–æ—Å—Ç—å –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å
   - UV –∏–Ω–¥–µ–∫—Å
   - –ò–∫–æ–Ω–∫–∞ –ø–æ–≥–æ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
   - –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≥–æ–¥—ã

2. –ê—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ:
   - –í–æ—Å—Ö–æ–¥ –∏ –∑–∞–∫–∞—Ç —Å–æ–ª–Ω—Ü–∞
   - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–≤–µ—Ç–æ–≤–æ–≥–æ –¥–Ω—è

3. –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π:
   - –î–Ω–µ–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –¥–∞—Ç–æ–π
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
   - –ò–∫–æ–Ω–∫–∞ –ø–æ–≥–æ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
   - –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Å–∞–¥–∫–æ–≤
   - UV –∏–Ω–¥–µ–∫—Å
   - –í–æ—Å—Ö–æ–¥/–∑–∞–∫–∞—Ç

4. –ü–æ–∏—Å–∫ –∏ –≥–µ–æ–∫–æ–¥–∏–Ω–≥:
   - –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–æ–≤ —á–µ—Ä–µ–∑ Nominatim OpenStreetMap API
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è (Geolocation API)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≥–æ—Ä–æ–¥–∞ –≤ localStorage

5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
   - –¢–µ–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
   - –ê–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. Open-Meteo API –¥–ª—è –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π, –±–µ–∑ API-–∫–ª—é—á–∞)
2. Nominatim –¥–ª—è –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞
3. LocalStorage –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
4. CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–º–∏–∑–∞—Ü–∏–∏
5. Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫
-->

<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
      :root {
        --bg-color: #e8f4fc;
        --card-bg: #ffffff;
        --text-color: #1a1a2e;
        --text-secondary: #4a4a6a;
        --border-color: #d0e4f0;
        --primary-color: #3498db;
        --primary-hover: #2980b9;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
        --gradient-start: #74b9ff;
        --gradient-end: #0984e3;
        --input-bg: #ffffff;
        --input-border: #d0e4f0;
        --uv-low: #3ea72d;
        --uv-moderate: #fff300;
        --uv-high: #f18b00;
        --uv-very-high: #e53210;
        --uv-extreme: #b567a4;
      }

      [data-theme="dark"] {
        --bg-color: #1a1a2e;
        --card-bg: #252540;
        --text-color: #e8e8e8;
        --text-secondary: #a0a0b0;
        --border-color: #3a3a5a;
        --primary-color: #5dade2;
        --primary-hover: #3498db;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.4);
        --gradient-start: #2c3e50;
        --gradient-end: #1a1a2e;
        --input-bg: #2d2d4a;
        --input-border: #3a3a5a;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Oxygen, Ubuntu, sans-serif;
        background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        min-height: 100vh;
        color: var(--text-color);
        transition: background 0.3s ease, color 0.3s ease;
        padding: 20px;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
      }

      /* –®–∞–ø–∫–∞ */
      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.2rem;
        color: var(--text-color);
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* –ü–æ–∏—Å–∫ */
      .search-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 30px;
      }

      .search-input {
        padding: 12px 20px;
        font-size: 1rem;
        border: 2px solid var(--input-border);
        border-radius: 30px;
        background: var(--input-bg);
        color: var(--text-color);
        width: 300px;
        max-width: 100%;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
      }

      .search-input::placeholder {
        color: var(--text-secondary);
      }

      .search-btn,
      .location-btn {
        padding: 12px 24px;
        font-size: 1rem;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .search-btn {
        background: var(--primary-color);
        color: white;
      }

      .search-btn:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
      }

      .location-btn {
        background: var(--card-bg);
        color: var(--text-color);
        border: 2px solid var(--border-color);
      }

      .location-btn:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
      }

      /* –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ */
      .current-weather {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 30px;
        box-shadow: var(--shadow);
        margin-bottom: 20px;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 20px;
        align-items: center;
      }

      .current-main {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .weather-icon {
        font-size: 5rem;
        color: var(--primary-color);
      }

      .current-temp {
        font-size: 4rem;
        font-weight: 300;
        color: var(--text-color);
      }

      .current-temp sup {
        font-size: 2rem;
        vertical-align: super;
      }

      .current-details h2 {
        font-size: 1.5rem;
        margin-bottom: 5px;
      }

      .current-details .description {
        color: var(--text-secondary);
        font-size: 1.1rem;
        margin-bottom: 10px;
        text-transform: capitalize;
      }

      .current-stats {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }

      .stat {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
      }

      .stat i {
        color: var(--primary-color);
        width: 16px;
        text-align: center;
      }

      .current-extra {
        text-align: right;
      }

      .feels-like {
        font-size: 1rem;
        color: var(--text-secondary);
        margin-bottom: 15px;
      }

      .date-time {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      /* –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
      .details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }

      .detail-card {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        transition: all 0.3s ease;
      }

      .detail-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-hover);
      }

      .detail-card i {
        font-size: 2rem;
        color: var(--primary-color);
        margin-bottom: 10px;
      }

      .detail-card .label {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 5px;
      }

      .detail-card .value {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-color);
      }

      .detail-card .sub-value {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-top: 5px;
      }

      /* UV –∏–Ω–¥–µ–∫—Å */
      .uv-indicator {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 5px;
      }

      .uv-bar {
        width: 100%;
        height: 6px;
        background: linear-gradient(to right,
          var(--uv-low) 0%,
          var(--uv-moderate) 25%,
          var(--uv-high) 50%,
          var(--uv-very-high) 75%,
          var(--uv-extreme) 100%);
        border-radius: 3px;
        position: relative;
      }

      .uv-marker {
        position: absolute;
        top: -4px;
        width: 14px;
        height: 14px;
        background: var(--text-color);
        border: 2px solid var(--card-bg);
        border-radius: 50%;
        transform: translateX(-50%);
      }

      .uv-level {
        font-size: 0.8rem;
        padding: 2px 8px;
        border-radius: 10px;
        color: white;
        font-weight: 500;
      }

      .uv-low { background: var(--uv-low); }
      .uv-moderate { background: var(--uv-moderate); color: #333; }
      .uv-high { background: var(--uv-high); }
      .uv-very-high { background: var(--uv-very-high); }
      .uv-extreme { background: var(--uv-extreme); }

      /* –°–æ–ª–Ω—Ü–µ */
      .sun-times {
        display: flex;
        justify-content: space-around;
        width: 100%;
        margin-top: 10px;
      }

      .sun-time {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .sun-time i {
        font-size: 1.2rem;
        margin-bottom: 5px;
      }

      .sun-time .time {
        font-size: 1rem;
        font-weight: 600;
      }

      .sun-time .label {
        font-size: 0.75rem;
        color: var(--text-secondary);
      }

      .sunrise i { color: #f39c12; }
      .sunset i { color: #e74c3c; }

      /* –õ—É–Ω–∞ */
      .moon-icon {
        font-size: 2.5rem;
        margin-bottom: 5px;
      }

      .moon-phase-visual {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(90deg, #1a1a2e 50%, #f5f5dc 50%);
        margin: 10px auto;
        position: relative;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(255, 255, 200, 0.3);
      }

      .moon-times {
        display: flex;
        justify-content: space-around;
        width: 100%;
        margin-top: 10px;
        font-size: 0.85rem;
      }

      .moon-time {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .moon-time i {
        font-size: 1rem;
        margin-bottom: 3px;
        color: #9b9b9b;
      }

      .moonrise i { color: #f39c12; }
      .moonset i { color: #e74c3c; }

      .illumination-bar {
        width: 100%;
        height: 6px;
        background: var(--border-color);
        border-radius: 3px;
        margin-top: 8px;
        overflow: hidden;
      }

      .illumination-fill {
        height: 100%;
        background: linear-gradient(90deg, #f5f5dc, #fffacd);
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      /* –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π */
      .forecast-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        color: var(--text-color);
      }

      .forecast-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }

      .forecast-card {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 20px 15px;
        text-align: center;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
      }

      .forecast-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-hover);
      }

      .forecast-day {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--text-color);
      }

      .forecast-date {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-bottom: 10px;
      }

      .forecast-icon {
        font-size: 2.2rem;
        color: var(--primary-color);
        margin-bottom: 10px;
      }

      .forecast-temps {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .temp-high {
        font-weight: 600;
        color: var(--text-color);
      }

      .temp-low {
        color: var(--text-secondary);
      }

      .forecast-details {
        font-size: 0.8rem;
        color: var(--text-secondary);
        display: flex;
        flex-direction: column;
        gap: 3px;
      }

      .forecast-details span {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
      }

      .forecast-details i {
        color: var(--primary-color);
        width: 14px;
      }

      /* –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
      .settings-button {
        position: fixed;
        top: 20px;
        right: 20px;
        font-size: 24px;
        color: var(--text-color);
        background-color: var(--card-bg);
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: var(--shadow);
        z-index: 1000;
        transition: all 0.3s ease;
        border: 2px solid var(--border-color);
      }

      .settings-button:hover {
        transform: rotate(45deg);
      }

      /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
      .settings-modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .settings-modal-content {
        background-color: var(--card-bg);
        margin: 15% auto;
        padding: 25px;
        border-radius: 15px;
        width: 320px;
        max-width: 90%;
        box-shadow: var(--shadow-hover);
      }

      .settings-modal h3 {
        margin-top: 0;
        margin-bottom: 20px;
        color: var(--text-color);
      }

      .settings-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 15px 0;
      }

      .settings-option label {
        color: var(--text-color);
        cursor: pointer;
        user-select: none;
        flex: 1;
        padding: 5px 0;
      }

      .theme-switch {
        position: relative;
        width: 50px;
        height: 24px;
      }

      .theme-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .theme-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }

      .theme-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .theme-slider {
        background-color: var(--primary-color);
      }

      input:checked + .theme-slider:before {
        transform: translateX(26px);
      }

      .close-settings {
        color: var(--text-color);
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        line-height: 1;
      }

      .close-settings:hover {
        opacity: 0.7;
      }

      /* –ó–∞–≥—Ä—É–∑–∫–∞ */
      .loading {
        display: none;
        text-align: center;
        padding: 50px;
      }

      .loading.active {
        display: block;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--border-color);
        border-top-color: var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* –û—à–∏–±–∫–∞ */
      .error-message {
        display: none;
        text-align: center;
        padding: 30px;
        background: var(--card-bg);
        border-radius: 15px;
        color: #e74c3c;
      }

      .error-message.active {
        display: block;
      }

      .error-message i {
        font-size: 3rem;
        margin-bottom: 15px;
      }

      /* –°–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ */
      .weather-content {
        display: none;
      }

      .weather-content.active {
        display: block;
      }

      /* –ê—Ç—Ä–∏–±—É—Ü–∏—è */
      .attribution {
        text-align: center;
        margin-top: 30px;
        padding: 15px;
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      .attribution a {
        color: var(--primary-color);
        text-decoration: none;
      }

      .attribution a:hover {
        text-decoration: underline;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.8rem;
        }

        .current-weather {
          grid-template-columns: 1fr;
          text-align: center;
        }

        .current-main {
          flex-direction: column;
        }

        .current-extra {
          text-align: center;
        }

        .current-stats {
          justify-content: center;
        }

        .search-input {
          width: 100%;
        }

        .settings-button {
          top: 15px;
          right: 15px;
          width: 40px;
          height: 40px;
          font-size: 20px;
        }

        .details-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        .forecast-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .weather-icon {
          font-size: 4rem;
        }

        .current-temp {
          font-size: 3rem;
        }

        .details-grid {
          grid-template-columns: 1fr 1fr;
        }

        .detail-card {
          padding: 15px;
        }

        .detail-card i {
          font-size: 1.5rem;
        }

        .detail-card .value {
          font-size: 1.1rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <button class="settings-button" id="settingsButton">
      <i class="fas fa-cog"></i>
    </button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsModal" class="settings-modal">
      <div class="settings-modal-content">
        <span class="close-settings" id="closeSettings">&times;</span>
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <div class="settings-option">
          <label for="themeSwitch">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</label>
          <div class="theme-switch">
            <input type="checkbox" id="themeSwitch" />
            <span class="theme-slider"></span>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="header">
        <h1><i class="fas fa-cloud-sun"></i> –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã</h1>
      </div>

      <!-- –ü–æ–∏—Å–∫ -->
      <div class="search-container">
        <input
          type="text"
          class="search-input"
          id="cityInput"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥..."
          autocomplete="off"
        />
        <button class="search-btn" id="searchBtn">
          <i class="fas fa-search"></i> –ù–∞–π—Ç–∏
        </button>
        <button class="location-btn" id="locationBtn">
          <i class="fas fa-location-crosshairs"></i> –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
        </button>
      </div>

      <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ...</p>
      </div>

      <!-- –û—à–∏–±–∫–∞ -->
      <div class="error-message" id="errorMessage">
        <i class="fas fa-exclamation-circle"></i>
        <p id="errorText">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</p>
      </div>

      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–≥–æ–¥—ã -->
      <div class="weather-content" id="weatherContent">
        <!-- –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ -->
        <div class="current-weather">
          <div>
            <div class="current-main">
              <i class="weather-icon" id="currentIcon"></i>
              <div>
                <div class="current-temp" id="currentTemp">--<sup>¬∞C</sup></div>
              </div>
            </div>
            <div class="current-details">
              <h2 id="cityName">--</h2>
              <p class="description" id="weatherDesc">--</p>
              <div class="current-stats">
                <div class="stat">
                  <i class="fas fa-tint"></i>
                  <span id="humidity">--%</span>
                </div>
                <div class="stat">
                  <i class="fas fa-wind"></i>
                  <span id="windSpeed">-- –∫–º/—á</span>
                </div>
                <div class="stat">
                  <i class="fas fa-compass"></i>
                  <span id="windDir">--</span>
                </div>
              </div>
            </div>
          </div>
          <div class="current-extra">
            <p class="feels-like">–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ <span id="feelsLike">--</span>¬∞C</p>
            <p class="date-time" id="dateTime">--</p>
          </div>
        </div>

        <!-- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="details-grid">
          <!-- –í–æ—Å—Ö–æ–¥/–ó–∞–∫–∞—Ç -->
          <div class="detail-card">
            <i class="fas fa-sun"></i>
            <span class="label">–°–æ–ª–Ω—Ü–µ</span>
            <div class="sun-times">
              <div class="sun-time sunrise">
                <i class="fas fa-arrow-up"></i>
                <span class="time" id="sunrise">--:--</span>
                <span class="label">–≤–æ—Å—Ö–æ–¥</span>
              </div>
              <div class="sun-time sunset">
                <i class="fas fa-arrow-down"></i>
                <span class="time" id="sunset">--:--</span>
                <span class="label">–∑–∞–∫–∞—Ç</span>
              </div>
            </div>
            <span class="sub-value" id="dayLength">–°–≤–µ—Ç–æ–≤–æ–π –¥–µ–Ω—å: --</span>
          </div>

          <!-- UV –∏–Ω–¥–µ–∫—Å -->
          <div class="detail-card">
            <i class="fas fa-sun"></i>
            <span class="label">UV –∏–Ω–¥–µ–∫—Å</span>
            <span class="value" id="uvIndex">--</span>
            <div class="uv-indicator">
              <div class="uv-bar">
                <div class="uv-marker" id="uvMarker"></div>
              </div>
            </div>
            <span class="uv-level" id="uvLevel">--</span>
          </div>

          <!-- –î–∞–≤–ª–µ–Ω–∏–µ -->
          <div class="detail-card">
            <i class="fas fa-tachometer-alt"></i>
            <span class="label">–î–∞–≤–ª–µ–Ω–∏–µ</span>
            <span class="value" id="pressure">-- –º–º</span>
            <span class="sub-value" id="pressureHpa">-- –≥–ü–∞</span>
          </div>

          <!-- –¢–æ—á–∫–∞ —Ä–æ—Å—ã -->
          <div class="detail-card">
            <i class="fas fa-droplet"></i>
            <span class="label">–¢–æ—á–∫–∞ —Ä–æ—Å—ã</span>
            <span class="value" id="dewPoint">--¬∞C</span>
            <span class="sub-value">–í–ª–∞–∂–Ω–æ—Å—Ç—å: <span id="humidityDetail">--%</span></span>
          </div>

          <!-- –û–±–ª–∞—á–Ω–æ—Å—Ç—å -->
          <div class="detail-card">
            <i class="fas fa-cloud"></i>
            <span class="label">–û–±–ª–∞—á–Ω–æ—Å—Ç—å</span>
            <span class="value" id="cloudCover">--%</span>
            <span class="sub-value" id="cloudDesc">--</span>
          </div>

          <!-- –í–µ—Ç–µ—Ä -->
          <div class="detail-card">
            <i class="fas fa-wind"></i>
            <span class="label">–í–µ—Ç–µ—Ä</span>
            <span class="value" id="windDetail">-- –∫–º/—á</span>
            <span class="sub-value">–ü–æ—Ä—ã–≤—ã: <span id="windGusts">-- –∫–º/—á</span></span>
          </div>

          <!-- –õ—É–Ω–∞ -->
          <div class="detail-card">
            <span class="moon-icon" id="moonIcon">üåô</span>
            <span class="label">–õ—É–Ω–∞</span>
            <span class="value" id="moonPhase">--</span>
            <div class="illumination-bar">
              <div class="illumination-fill" id="illuminationFill" style="width: 0%"></div>
            </div>
            <span class="sub-value">–û—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç—å: <span id="moonIllumination">--%</span></span>
            <div class="moon-times">
              <div class="moon-time moonrise">
                <i class="fas fa-arrow-up"></i>
                <span id="moonrise">--:--</span>
              </div>
              <div class="moon-time moonset">
                <i class="fas fa-arrow-down"></i>
                <span id="moonset">--:--</span>
              </div>
            </div>
          </div>
        </div>

        <!-- –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π -->
        <h3 class="forecast-title"><i class="fas fa-calendar-alt"></i> –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π</h3>
        <div class="forecast-grid" id="forecastGrid">
          <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>

      <!-- –ê—Ç—Ä–∏–±—É—Ü–∏—è -->
      <div class="attribution">
        –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã <a href="https://open-meteo.com/" target="_blank">Open-Meteo</a>,
        <a href="https://wttr.in/" target="_blank">wttr.in</a>
        –∏ <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a>
      </div>
    </div>

    <script>
      // === –ö–û–ù–°–¢–ê–ù–¢–´ ===
      const CACHE_TTL = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç
      const STORAGE_KEY_CITY = 'weather_forecast_last_city';

      // === –ü–û–ì–û–î–ù–´–ï –ö–û–î–´ –ò –ò–ö–û–ù–ö–ò ===
      const weatherCodes = {
        0: { icon: 'fa-sun', desc: '–Ø—Å–Ω–æ' },
        1: { icon: 'fa-sun', desc: '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —è—Å–Ω–æ' },
        2: { icon: 'fa-cloud-sun', desc: '–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å' },
        3: { icon: 'fa-cloud', desc: '–û–±–ª–∞—á–Ω–æ' },
        45: { icon: 'fa-smog', desc: '–¢—É–º–∞–Ω' },
        48: { icon: 'fa-smog', desc: '–ò–∑–º–æ—Ä–æ–∑—å' },
        51: { icon: 'fa-cloud-rain', desc: '–õ–µ–≥–∫–∞—è –º–æ—Ä–æ—Å—å' },
        53: { icon: 'fa-cloud-rain', desc: '–£–º–µ—Ä–µ–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å' },
        55: { icon: 'fa-cloud-rain', desc: '–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å' },
        56: { icon: 'fa-cloud-meatball', desc: '–õ–µ–¥—è–Ω–∞—è –º–æ—Ä–æ—Å—å' },
        57: { icon: 'fa-cloud-meatball', desc: '–°–∏–ª—å–Ω–∞—è –ª–µ–¥—è–Ω–∞—è –º–æ—Ä–æ—Å—å' },
        61: { icon: 'fa-cloud-showers-heavy', desc: '–ù–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å' },
        63: { icon: 'fa-cloud-showers-heavy', desc: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å' },
        65: { icon: 'fa-cloud-showers-heavy', desc: '–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å' },
        66: { icon: 'fa-cloud-meatball', desc: '–õ–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å' },
        67: { icon: 'fa-cloud-meatball', desc: '–°–∏–ª—å–Ω—ã–π –ª–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å' },
        71: { icon: 'fa-snowflake', desc: '–ù–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥' },
        73: { icon: 'fa-snowflake', desc: '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–Ω–µ–≥' },
        75: { icon: 'fa-snowflake', desc: '–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥' },
        77: { icon: 'fa-snowflake', desc: '–°–Ω–µ–∂–Ω–∞—è –∫—Ä—É–ø–∞' },
        80: { icon: 'fa-cloud-showers-heavy', desc: '–õ–∏–≤–µ–Ω—å' },
        81: { icon: 'fa-cloud-showers-heavy', desc: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –ª–∏–≤–µ–Ω—å' },
        82: { icon: 'fa-cloud-showers-heavy', desc: '–°–∏–ª—å–Ω—ã–π –ª–∏–≤–µ–Ω—å' },
        85: { icon: 'fa-snowflake', desc: '–°–Ω–µ–≥–æ–ø–∞–¥' },
        86: { icon: 'fa-snowflake', desc: '–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥' },
        95: { icon: 'fa-bolt', desc: '–ì—Ä–æ–∑–∞' },
        96: { icon: 'fa-bolt', desc: '–ì—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º' },
        99: { icon: 'fa-bolt', desc: '–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º' }
      };

      // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ç—Ä–∞
      const windDirections = ['–°', '–°–í', '–í', '–Æ–í', '–Æ', '–Æ–ó', '–ó', '–°–ó'];

      // –î–Ω–∏ –Ω–µ–¥–µ–ª–∏
      const weekDays = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];

      // UV —É—Ä–æ–≤–Ω–∏
      const uvLevels = [
        { max: 2, label: '–ù–∏–∑–∫–∏–π', class: 'uv-low' },
        { max: 5, label: '–£–º–µ—Ä–µ–Ω–Ω—ã–π', class: 'uv-moderate' },
        { max: 7, label: '–í—ã—Å–æ–∫–∏–π', class: 'uv-high' },
        { max: 10, label: '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π', class: 'uv-very-high' },
        { max: Infinity, label: '–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π', class: 'uv-extreme' }
      ];

      // === –ö–ï–®–ò–†–û–í–ê–ù–ò–ï ===
      const cache = {
        get(key) {
          const item = localStorage.getItem('weather_cache_' + key);
          if (!item) return null;
          try {
            const parsed = JSON.parse(item);
            if (parsed.timestamp && Date.now() - parsed.timestamp < CACHE_TTL) {
              return parsed.data;
            }
            localStorage.removeItem('weather_cache_' + key);
            return null;
          } catch (e) {
            return null;
          }
        },
        set(key, data) {
          localStorage.setItem(
            'weather_cache_' + key,
            JSON.stringify({ timestamp: Date.now(), data })
          );
        }
      };

      // === –ì–ï–û–ö–û–î–ò–ù–ì ===
      async function geocodeCity(city) {
        const cacheKey = 'geo_' + city.toLowerCase().replace(/\s+/g, '_');
        let geo = cache.get(cacheKey);
        if (geo) return geo;

        const resp = await fetch(
          `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`
        );
        const data = await resp.json();
        if (!data.length) throw new Error('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');

        cache.set(cacheKey, data[0]);
        return data[0];
      }

      // === –ü–û–ì–û–î–ê ===
      async function getWeather(lat, lon) {
        const cacheKey = `forecast_${Math.round(lat * 100) / 100}_${Math.round(lon * 100) / 100}`;
        let data = cache.get(cacheKey);
        if (data) return data;

        const currentParams = [
          'temperature_2m',
          'relative_humidity_2m',
          'apparent_temperature',
          'weather_code',
          'wind_speed_10m',
          'wind_direction_10m',
          'wind_gusts_10m',
          'surface_pressure',
          'dew_point_2m',
          'cloud_cover'
        ].join(',');

        const dailyParams = [
          'weather_code',
          'temperature_2m_max',
          'temperature_2m_min',
          'precipitation_probability_max',
          'wind_speed_10m_max',
          'uv_index_max',
          'sunrise',
          'sunset'
        ].join(',');

        const url = `https://api.open-meteo.com/v1/forecast?` +
          `latitude=${lat}&longitude=${lon}` +
          `&current=${currentParams}` +
          `&daily=${dailyParams}` +
          `&timezone=auto&forecast_days=7`;

        const resp = await fetch(url);
        if (!resp.ok) throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ');

        data = await resp.json();
        cache.set(cacheKey, data);
        return data;
      }

      // === –û–ë–†–ê–¢–ù–´–ô –ì–ï–û–ö–û–î–ò–ù–ì ===
      async function reverseGeocode(lat, lon) {
        const cacheKey = `rgeo_${Math.round(lat * 100) / 100}_${Math.round(lon * 100) / 100}`;
        let data = cache.get(cacheKey);
        if (data) return data;

        const resp = await fetch(
          `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
        );
        data = await resp.json();
        cache.set(cacheKey, data);
        return data;
      }

      // === –î–ê–ù–ù–´–ï –û –õ–£–ù–ï (wttr.in API) ===
      async function getMoonData(city) {
        const cacheKey = `moon_${city.toLowerCase().replace(/\s+/g, '_')}`;
        let data = cache.get(cacheKey);
        if (data) return data;

        try {
          const resp = await fetch(`https://wttr.in/${encodeURIComponent(city)}?format=j1`);
          if (!resp.ok) return null;
          data = await resp.json();
          cache.set(cacheKey, data);
          return data;
        } catch (e) {
          console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ª—É–Ω–µ:', e);
          return null;
        }
      }

      // –§–∞–∑—ã –ª—É–Ω—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —Å —ç–º–æ–¥–∑–∏
      const moonPhases = {
        'New Moon': { name: '–ù–æ–≤–æ–ª—É–Ω–∏–µ', emoji: 'üåë' },
        'Waxing Crescent': { name: '–†–∞—Å—Ç—É—â–∏–π —Å–µ—Ä–ø', emoji: 'üåí' },
        'First Quarter': { name: '–ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å', emoji: 'üåì' },
        'Waxing Gibbous': { name: '–†–∞—Å—Ç—É—â–∞—è –ª—É–Ω–∞', emoji: 'üåî' },
        'Full Moon': { name: '–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ', emoji: 'üåï' },
        'Waning Gibbous': { name: '–£–±—ã–≤–∞—é—â–∞—è –ª—É–Ω–∞', emoji: 'üåñ' },
        'Last Quarter': { name: '–ü–æ—Å–ª–µ–¥–Ω—è—è —á–µ—Ç–≤–µ—Ä—Ç—å', emoji: 'üåó' },
        'Waning Crescent': { name: '–£–±—ã–≤–∞—é—â–∏–π —Å–µ—Ä–ø', emoji: 'üåò' }
      };

      function getMoonPhaseInfo(phase) {
        return moonPhases[phase] || { name: phase, emoji: 'üåô' };
      }

      // === UI –§–£–ù–ö–¶–ò–ò ===
      function showLoading() {
        document.getElementById('loading').classList.add('active');
        document.getElementById('weatherContent').classList.remove('active');
        document.getElementById('errorMessage').classList.remove('active');
      }

      function hideLoading() {
        document.getElementById('loading').classList.remove('active');
      }

      function showError(message) {
        hideLoading();
        document.getElementById('errorText').textContent = message;
        document.getElementById('errorMessage').classList.add('active');
        document.getElementById('weatherContent').classList.remove('active');
      }

      function showWeather() {
        hideLoading();
        document.getElementById('weatherContent').classList.add('active');
        document.getElementById('errorMessage').classList.remove('active');
      }

      function getWeatherInfo(code) {
        return weatherCodes[code] || { icon: 'fa-question', desc: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' };
      }

      function getWindDirection(degrees) {
        const index = Math.round(degrees / 45) % 8;
        return windDirections[index];
      }

      function formatDate(dateStr) {
        const date = new Date(dateStr);
        return `${date.getDate()}.${String(date.getMonth() + 1).padStart(2, '0')}`;
      }

      function getDayName(dateStr, isToday = false) {
        if (isToday) return '–°–µ–≥–æ–¥–Ω—è';
        const date = new Date(dateStr);
        return weekDays[date.getDay()];
      }

      function formatTime(isoString) {
        const date = new Date(isoString);
        return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
      }

      function calculateDayLength(sunrise, sunset) {
        const start = new Date(sunrise);
        const end = new Date(sunset);
        const diff = (end - start) / 1000 / 60; // –º–∏–Ω—É—Ç—ã
        const hours = Math.floor(diff / 60);
        const minutes = Math.round(diff % 60);
        return `${hours}—á ${minutes}–º`;
      }

      function hpaToMmHg(hpa) {
        return Math.round(hpa * 0.750062);
      }

      function getUvLevel(uv) {
        for (const level of uvLevels) {
          if (uv <= level.max) return level;
        }
        return uvLevels[uvLevels.length - 1];
      }

      function getCloudDescription(percent) {
        if (percent <= 10) return '–Ø—Å–Ω–æ';
        if (percent <= 25) return '–ú–∞–ª–æ–æ–±–ª–∞—á–Ω–æ';
        if (percent <= 50) return '–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å';
        if (percent <= 75) return '–û–±–ª–∞—á–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏';
        if (percent <= 90) return '–û–±–ª–∞—á–Ω–æ';
        return '–ü–∞—Å–º—É—Ä–Ω–æ';
      }

      // === –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ü–û–ì–û–î–´ ===
      function displayWeather(weatherData, cityName) {
        const current = weatherData.current;
        const daily = weatherData.daily;

        // –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞
        const weatherInfo = getWeatherInfo(current.weather_code);
        document.getElementById('currentIcon').className = `weather-icon fas ${weatherInfo.icon}`;
        document.getElementById('currentTemp').innerHTML =
          `${Math.round(current.temperature_2m)}<sup>¬∞C</sup>`;
        document.getElementById('cityName').textContent = cityName;
        document.getElementById('weatherDesc').textContent = weatherInfo.desc;
        document.getElementById('humidity').textContent = `${current.relative_humidity_2m}%`;
        document.getElementById('windSpeed').textContent =
          `${Math.round(current.wind_speed_10m)} –∫–º/—á`;
        document.getElementById('windDir').textContent =
          getWindDirection(current.wind_direction_10m);
        document.getElementById('feelsLike').textContent =
          Math.round(current.apparent_temperature);

        // –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
        const now = new Date();
        const options = {
          weekday: 'long',
          day: 'numeric',
          month: 'long',
          hour: '2-digit',
          minute: '2-digit'
        };
        document.getElementById('dateTime').textContent =
          now.toLocaleDateString('ru-RU', options);

        // –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        // –í–æ—Å—Ö–æ–¥/–ó–∞–∫–∞—Ç
        document.getElementById('sunrise').textContent = formatTime(daily.sunrise[0]);
        document.getElementById('sunset').textContent = formatTime(daily.sunset[0]);
        document.getElementById('dayLength').textContent =
          `–°–≤–µ—Ç–æ–≤–æ–π –¥–µ–Ω—å: ${calculateDayLength(daily.sunrise[0], daily.sunset[0])}`;

        // UV –∏–Ω–¥–µ–∫—Å
        const uvValue = daily.uv_index_max[0];
        document.getElementById('uvIndex').textContent = uvValue.toFixed(1);
        const uvLevel = getUvLevel(uvValue);
        const uvLevelEl = document.getElementById('uvLevel');
        uvLevelEl.textContent = uvLevel.label;
        uvLevelEl.className = `uv-level ${uvLevel.class}`;
        // –ü–æ–∑–∏—Ü–∏—è –º–∞—Ä–∫–µ—Ä–∞ (UV —à–∫–∞–ª–∞ 0-11+)
        const markerPos = Math.min(uvValue / 11 * 100, 100);
        document.getElementById('uvMarker').style.left = `${markerPos}%`;

        // –î–∞–≤–ª–µ–Ω–∏–µ
        const pressureHpa = current.surface_pressure;
        document.getElementById('pressure').textContent = `${hpaToMmHg(pressureHpa)} –º–º —Ä—Ç.—Å—Ç.`;
        document.getElementById('pressureHpa').textContent = `${Math.round(pressureHpa)} –≥–ü–∞`;

        // –¢–æ—á–∫–∞ —Ä–æ—Å—ã
        document.getElementById('dewPoint').textContent = `${Math.round(current.dew_point_2m)}¬∞C`;
        document.getElementById('humidityDetail').textContent = `${current.relative_humidity_2m}%`;

        // –û–±–ª–∞—á–Ω–æ—Å—Ç—å
        document.getElementById('cloudCover').textContent = `${current.cloud_cover}%`;
        document.getElementById('cloudDesc').textContent = getCloudDescription(current.cloud_cover);

        // –í–µ—Ç–µ—Ä –¥–µ—Ç–∞–ª—å–Ω–æ
        document.getElementById('windDetail').textContent =
          `${Math.round(current.wind_speed_10m)} –∫–º/—á ${getWindDirection(current.wind_direction_10m)}`;
        document.getElementById('windGusts').textContent =
          `${Math.round(current.wind_gusts_10m)} –∫–º/—á`;

        // –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π
        const forecastGrid = document.getElementById('forecastGrid');
        forecastGrid.innerHTML = '';

        for (let i = 0; i < daily.time.length; i++) {
          const dayInfo = getWeatherInfo(daily.weather_code[i]);
          const card = document.createElement('div');
          card.className = 'forecast-card';
          card.innerHTML = `
            <div class="forecast-day">${getDayName(daily.time[i], i === 0)}</div>
            <div class="forecast-date">${formatDate(daily.time[i])}</div>
            <i class="forecast-icon fas ${dayInfo.icon}"></i>
            <div class="forecast-temps">
              <span class="temp-high">${Math.round(daily.temperature_2m_max[i])}¬∞</span>
              <span class="temp-low">${Math.round(daily.temperature_2m_min[i])}¬∞</span>
            </div>
            <div class="forecast-details">
              <span><i class="fas fa-tint"></i> ${daily.precipitation_probability_max[i]}%</span>
              <span><i class="fas fa-sun"></i> UV ${daily.uv_index_max[i].toFixed(0)}</span>
              <span><i class="fas fa-arrow-up"></i> ${formatTime(daily.sunrise[i])}</span>
            </div>
          `;
          forecastGrid.appendChild(card);
        }

        showWeather();
      }

      // === –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –î–ê–ù–ù–´–• –û –õ–£–ù–ï ===
      function displayMoonData(moonData) {
        if (!moonData || !moonData.weather || !moonData.weather[0] || !moonData.weather[0].astronomy) {
          return;
        }

        const astronomy = moonData.weather[0].astronomy[0];

        // –§–∞–∑–∞ –ª—É–Ω—ã
        const phaseInfo = getMoonPhaseInfo(astronomy.moon_phase);
        document.getElementById('moonIcon').textContent = phaseInfo.emoji;
        document.getElementById('moonPhase').textContent = phaseInfo.name;

        // –û—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç—å
        const illumination = parseInt(astronomy.moon_illumination) || 0;
        document.getElementById('moonIllumination').textContent = `${illumination}%`;
        document.getElementById('illuminationFill').style.width = `${illumination}%`;

        // –í–æ—Å—Ö–æ–¥/–∑–∞–∫–∞—Ç –ª—É–Ω—ã
        const moonrise = astronomy.moonrise || '--:--';
        const moonset = astronomy.moonset || '--:--';
        document.getElementById('moonrise').textContent = moonrise;
        document.getElementById('moonset').textContent = moonset;
      }

      // === –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –ü–û–ì–û–î–´ ===
      async function loadWeather(cityOrCoords) {
        showLoading();

        try {
          let lat, lon, cityName;

          if (typeof cityOrCoords === 'string') {
            // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≥–æ—Ä–æ–¥–∞
            const geo = await geocodeCity(cityOrCoords);
            lat = parseFloat(geo.lat);
            lon = parseFloat(geo.lon);
            cityName = geo.display_name.split(',').slice(0, 2).join(', ');

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–æ—Ä–æ–¥
            localStorage.setItem(STORAGE_KEY_CITY, cityOrCoords);
          } else {
            // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            lat = cityOrCoords.lat;
            lon = cityOrCoords.lon;

            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
            const geoData = await reverseGeocode(lat, lon);
            cityName = geoData.address?.city || geoData.address?.town ||
              geoData.address?.village || geoData.display_name?.split(',')[0] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
          }

          const weatherData = await getWeather(lat, lon);
          displayWeather(weatherData, cityName);

          // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ª—É–Ω–µ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç)
          const searchCity = typeof cityOrCoords === 'string' ? cityOrCoords : cityName.split(',')[0];
          getMoonData(searchCity).then(moonData => {
            if (moonData) displayMoonData(moonData);
          });

        } catch (error) {
          console.error('–û—à–∏–±–∫–∞:', error);
          showError(error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ');
        }
      }

      // === –ì–ï–û–õ–û–ö–ê–¶–ò–Ø ===
      function getUserLocation() {
        if (!navigator.geolocation) {
          showError('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
          return;
        }

        showLoading();

        navigator.geolocation.getCurrentPosition(
          (position) => {
            loadWeather({
              lat: position.coords.latitude,
              lon: position.coords.longitude
            });
          },
          (error) => {
            let message = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
            if (error.code === 1) {
              message = '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω';
            } else if (error.code === 2) {
              message = '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
            } else if (error.code === 3) {
              message = '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ';
            }
            showError(message);
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }
        );
      }

      // === –°–ò–°–¢–ï–ú–ê –ù–ê–°–¢–†–û–ï–ö ===
      window.aiPagesSettings = {
        defaults: {
          theme: 'light'
        },

        get(key) {
          const value = localStorage.getItem(key);
          return value !== null ? value : this.defaults[key];
        },

        set(key, value) {
          localStorage.setItem(key, value);
          if (key === 'theme') {
            this.applyTheme();
          }
          this.notifyChange(key, value);
        },

        applyTheme() {
          const theme = this.get('theme');
          document.documentElement.setAttribute('data-theme', theme);
          const themeSwitch = document.getElementById('themeSwitch');
          if (themeSwitch) {
            themeSwitch.checked = theme === 'dark';
          }
        },

        migrate() {
          const oldTheme = localStorage.getItem('settings.darkTheme');
          if (oldTheme === 'true' && !localStorage.getItem('theme')) {
            localStorage.setItem('theme', 'dark');
            localStorage.removeItem('settings.darkTheme');
          }
        },

        init() {
          this.migrate();
          this.applyTheme();

          if (typeof BroadcastChannel !== 'undefined') {
            this.broadcastChannel = new BroadcastChannel('aiPagesSettings');
            this.broadcastChannel.onmessage = (event) => {
              const { type, key } = event.data;
              if (type === 'setting-changed' && key === 'theme') {
                this.applyTheme();
              }
            };
          }
        },

        notifyChange(key, value) {
          if (this.broadcastChannel) {
            this.broadcastChannel.postMessage({
              type: 'setting-changed',
              key: key,
              value: value
            });
          }
        }
      };

      // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
      document.addEventListener('DOMContentLoaded', function() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        window.aiPagesSettings.init();

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const cityInput = document.getElementById('cityInput');
        const searchBtn = document.getElementById('searchBtn');
        const locationBtn = document.getElementById('locationBtn');
        const settingsButton = document.getElementById('settingsButton');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettings = document.getElementById('closeSettings');
        const themeSwitch = document.getElementById('themeSwitch');

        // –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞
        function searchCity() {
          const city = cityInput.value.trim();
          if (city) {
            loadWeather(city);
          }
        }

        searchBtn.addEventListener('click', searchCity);
        cityInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') searchCity();
        });

        // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
        locationBtn.addEventListener('click', getUserLocation);

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        settingsButton.addEventListener('click', () => {
          settingsModal.style.display = 'block';
        });

        closeSettings.addEventListener('click', () => {
          settingsModal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
          if (e.target === settingsModal) {
            settingsModal.style.display = 'none';
          }
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && settingsModal.style.display === 'block') {
            settingsModal.style.display = 'none';
          }
        });

        themeSwitch.addEventListener('change', function() {
          const theme = this.checked ? 'dark' : 'light';
          window.aiPagesSettings.set('theme', theme);
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const lastCity = localStorage.getItem(STORAGE_KEY_CITY) || '–ú–æ—Å–∫–≤–∞';
        cityInput.value = lastCity;
        loadWeather(lastCity);
      });
    </script>
  </body>
</html>
